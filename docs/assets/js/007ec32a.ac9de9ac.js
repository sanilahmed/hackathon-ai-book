"use strict";(globalThis.webpackChunkphysical_ai_book=globalThis.webpackChunkphysical_ai_book||[]).push([[1142],{432:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>m});var r=n(4848),s=n(8453);const a={},o="Lab 1.3: Robot State Management",i={id:"modules/lab-exercises/lab-1-3-robot-state-management",title:"Lab 1.3: Robot State Management",description:"Overview",source:"@site/docs/modules/lab-exercises/lab-1-3-robot-state-management.md",sourceDirName:"modules/lab-exercises",slug:"/modules/lab-exercises/lab-1-3-robot-state-management",permalink:"/ai-robotic-book/modules/lab-exercises/lab-1-3-robot-state-management",draft:!1,unlisted:!1,editUrl:"https://github.com/your-org/physical-ai-book/tree/main/docs/modules/lab-exercises/lab-1-3-robot-state-management.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Lab 1.2: ROS 2 Services and Actions",permalink:"/ai-robotic-book/modules/lab-exercises/lab-1-2-ros2-services-actions"},next:{title:"Module 1 References: ROS 2 Robotic Nervous System",permalink:"/ai-robotic-book/modules/ros2-nervous-system/references"}},l={},m=[{value:"Overview",id:"overview",level:2},{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Duration",id:"duration",level:2},{value:"Exercise 1: Understanding TF Trees",id:"exercise-1-understanding-tf-trees",level:2},{value:"Step 1: Install TF2 tools",id:"step-1-install-tf2-tools",level:3},{value:"Step 2: Create a robot state management package",id:"step-2-create-a-robot-state-management-package",level:3},{value:"Step 3: Create a simple URDF robot model",id:"step-3-create-a-simple-urdf-robot-model",level:3},{value:"Exercise 2: Implement Robot State Publisher",id:"exercise-2-implement-robot-state-publisher",level:2},{value:"Step 1: Create the robot state publisher node",id:"step-1-create-the-robot-state-publisher-node",level:3},{value:"Exercise 3: Create Joint State Publisher",id:"exercise-3-create-joint-state-publisher",level:2},{value:"Step 1: Create a separate joint state publisher",id:"step-1-create-a-separate-joint-state-publisher",level:3},{value:"Exercise 4: TF Transform Utilities",id:"exercise-4-tf-transform-utilities",level:2},{value:"Step 1: Create TF listener and transform utilities",id:"step-1-create-tf-listener-and-transform-utilities",level:3},{value:"Exercise 5: URDF Robot State Publisher Integration",id:"exercise-5-urdf-robot-state-publisher-integration",level:2},{value:"Step 1: Create a URDF-based robot state publisher",id:"step-1-create-a-urdf-based-robot-state-publisher",level:3},{value:"Exercise 6: Update setup.py",id:"exercise-6-update-setuppy",level:2},{value:"Exercise 7: Build and Test the Robot State System",id:"exercise-7-build-and-test-the-robot-state-system",level:2},{value:"Step 1: Build the package",id:"step-1-build-the-package",level:3},{value:"Step 2: Source the workspace",id:"step-2-source-the-workspace",level:3},{value:"Step 3: Launch the robot state publisher",id:"step-3-launch-the-robot-state-publisher",level:3},{value:"Step 4: In another terminal, check the joint states",id:"step-4-in-another-terminal-check-the-joint-states",level:3},{value:"Step 5: Check the TF tree",id:"step-5-check-the-tf-tree",level:3},{value:"Step 6: Use TF echo to check specific transforms",id:"step-6-use-tf-echo-to-check-specific-transforms",level:3},{value:"Exercise 8: Robot State Visualization",id:"exercise-8-robot-state-visualization",level:2},{value:"Step 1: Create a visualization node",id:"step-1-create-a-visualization-node",level:3},{value:"Exercise 9: Testing with RViz2",id:"exercise-9-testing-with-rviz2",level:2},{value:"Step 1: Launch the robot state publisher and visualizer",id:"step-1-launch-the-robot-state-publisher-and-visualizer",level:3},{value:"Step 2: Launch RViz2 to visualize the robot",id:"step-2-launch-rviz2-to-visualize-the-robot",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues and Solutions",id:"common-issues-and-solutions",level:3},{value:"Assessment Questions",id:"assessment-questions",level:2},{value:"Extension Exercises",id:"extension-exercises",level:2},{value:"Summary",id:"summary",level:2}];function c(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{id:"lab-13-robot-state-management",children:"Lab 1.3: Robot State Management"}),"\n",(0,r.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(t.p,{children:"In this lab, you will learn about robot state management in ROS 2, focusing on TF (Transforms) trees, robot state publisher, and joint state management. You'll implement systems to track and broadcast the robot's state, including positions, orientations, and joint angles."}),"\n",(0,r.jsx)(t.h2,{id:"objectives",children:"Objectives"}),"\n",(0,r.jsx)(t.p,{children:"By the end of this lab, you will be able to:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Understand the TF tree concept and its importance in robotics"}),"\n",(0,r.jsx)(t.li,{children:"Implement robot state publisher for broadcasting transforms"}),"\n",(0,r.jsx)(t.li,{children:"Create joint state publisher for tracking joint positions"}),"\n",(0,r.jsx)(t.li,{children:"Use TF tools for debugging and visualization"}),"\n",(0,r.jsx)(t.li,{children:"Integrate robot state management with URDF models"}),"\n",(0,r.jsx)(t.li,{children:"Transform coordinates between different frames"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Completion of Lab 1.1 and Lab 1.2"}),"\n",(0,r.jsx)(t.li,{children:"Understanding of ROS 2 topics, services, and actions"}),"\n",(0,r.jsx)(t.li,{children:"Basic knowledge of coordinate systems and transformations"}),"\n",(0,r.jsx)(t.li,{children:"Understanding of robot kinematics concepts"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"duration",children:"Duration"}),"\n",(0,r.jsx)(t.p,{children:"3 hours"}),"\n",(0,r.jsx)(t.h2,{id:"exercise-1-understanding-tf-trees",children:"Exercise 1: Understanding TF Trees"}),"\n",(0,r.jsx)(t.h3,{id:"step-1-install-tf2-tools",children:"Step 1: Install TF2 tools"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"sudo apt update\nsudo apt install ros-humble-tf2-tools ros-humble-tf2-ros\n"})}),"\n",(0,r.jsx)(t.h3,{id:"step-2-create-a-robot-state-management-package",children:"Step 2: Create a robot state management package"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"cd ~/ros2_ws/src\nros2 pkg create --build-type ament_python robot_state_py --dependencies rclpy std_msgs sensor_msgs geometry_msgs tf2_ros tf2_geometry_msgs tf2_msgs\n"})}),"\n",(0,r.jsx)(t.h3,{id:"step-3-create-a-simple-urdf-robot-model",children:"Step 3: Create a simple URDF robot model"}),"\n",(0,r.jsx)(t.p,{children:"Create the URDF directory:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"mkdir -p ~/ros2_ws/src/robot_state_py/robot_state_py/urdf\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Create ",(0,r.jsx)(t.code,{children:"~/ros2_ws/src/robot_state_py/robot_state_py/urdf/simple_robot.urdf"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<robot name="simple_robot">\n  \x3c!-- Base link --\x3e\n  <link name="base_link">\n    <visual>\n      <geometry>\n        <box size="0.5 0.3 0.2"/>\n      </geometry>\n      <material name="blue">\n        <color rgba="0 0 1 0.8"/>\n      </material>\n    </visual>\n    <collision>\n      <geometry>\n        <box size="0.5 0.3 0.2"/>\n      </geometry>\n    </collision>\n    <inertial>\n      <mass value="1.0"/>\n      <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.1"/>\n    </inertial>\n  </link>\n\n  \x3c!-- Base footprint for ground contact --\x3e\n  <link name="base_footprint">\n    <visual>\n      <geometry>\n        <cylinder radius="0.25" length="0.01"/>\n      </geometry>\n      <material name="gray">\n        <color rgba="0.5 0.5 0.5 0.8"/>\n      </material>\n    </visual>\n  </link>\n\n  \x3c!-- Joint connecting base_footprint to base_link --\x3e\n  <joint name="base_joint" type="fixed">\n    <parent link="base_footprint"/>\n    <child link="base_link"/>\n    <origin xyz="0 0 0.1" rpy="0 0 0"/>\n  </joint>\n\n  \x3c!-- Left wheel --\x3e\n  <link name="left_wheel">\n    <visual>\n      <geometry>\n        <cylinder radius="0.1" length="0.05"/>\n      </geometry>\n      <material name="black">\n        <color rgba="0 0 0 1"/>\n      </material>\n    </visual>\n  </link>\n\n  <joint name="left_wheel_joint" type="continuous">\n    <parent link="base_link"/>\n    <child link="left_wheel"/>\n    <origin xyz="0.15 0.15 -0.1" rpy="1.5708 0 0"/>\n    <axis xyz="0 0 1"/>\n  </joint>\n\n  \x3c!-- Right wheel --\x3e\n  <link name="right_wheel">\n    <visual>\n      <geometry>\n        <cylinder radius="0.1" length="0.05"/>\n      </geometry>\n      <material name="black">\n        <color rgba="0 0 0 1"/>\n      </material>\n    </visual>\n  </link>\n\n  <joint name="right_wheel_joint" type="continuous">\n    <parent link="base_link"/>\n    <child link="right_wheel"/>\n    <origin xyz="0.15 -0.15 -0.1" rpy="1.5708 0 0"/>\n    <axis xyz="0 0 1"/>\n  </joint>\n\n  \x3c!-- Camera link --\x3e\n  <link name="camera_link">\n    <visual>\n      <geometry>\n        <box size="0.05 0.05 0.05"/>\n      </geometry>\n      <material name="red">\n        <color rgba="1 0 0 0.8"/>\n      </material>\n    </visual>\n  </link>\n\n  <joint name="camera_joint" type="fixed">\n    <parent link="base_link"/>\n    <child link="camera_link"/>\n    <origin xyz="0.2 0 0.05" rpy="0 0 0"/>\n  </joint>\n</robot>\n'})}),"\n",(0,r.jsx)(t.h2,{id:"exercise-2-implement-robot-state-publisher",children:"Exercise 2: Implement Robot State Publisher"}),"\n",(0,r.jsx)(t.h3,{id:"step-1-create-the-robot-state-publisher-node",children:"Step 1: Create the robot state publisher node"}),"\n",(0,r.jsxs)(t.p,{children:["Create ",(0,r.jsx)(t.code,{children:"~/ros2_ws/src/robot_state_py/robot_state_py/robot_state_publisher.py"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"#!/usr/bin/env python3\n# robot_state_publisher.py\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState\nfrom geometry_msgs.msg import TransformStamped\nfrom tf2_ros import TransformBroadcaster\nimport math\n\n\nclass RobotStatePublisher(Node):\n    def __init__(self):\n        super().__init__('robot_state_publisher')\n\n        # Create publisher for joint states\n        self.joint_state_publisher = self.create_publisher(\n            JointState, 'joint_states', 10\n        )\n\n        # Create transform broadcaster\n        self.tf_broadcaster = TransformBroadcaster(self)\n\n        # Create timer to publish states\n        timer_period = 0.1  # 10 Hz\n        self.timer = self.create_timer(timer_period, self.publish_states)\n\n        # Initialize joint positions\n        self.time = 0.0\n\n        self.get_logger().info('Robot State Publisher started')\n\n    def publish_states(self):\n        # Create joint state message\n        joint_state = JointState()\n        joint_state.header.stamp = self.get_clock().now().to_msg()\n        joint_state.header.frame_id = 'base_footprint'\n\n        # Set joint names\n        joint_state.name = ['left_wheel_joint', 'right_wheel_joint']\n\n        # Simulate wheel rotation\n        self.time += 0.1\n        left_wheel_pos = math.sin(self.time) * 0.5\n        right_wheel_pos = math.cos(self.time) * 0.5\n\n        # Set joint positions\n        joint_state.position = [left_wheel_pos, right_wheel_pos]\n        joint_state.velocity = [math.cos(self.time) * 0.5, -math.sin(self.time) * 0.5]\n        joint_state.effort = [0.0, 0.0]\n\n        # Publish joint states\n        self.joint_state_publisher.publish(joint_state)\n\n        # Broadcast transforms\n        self.broadcast_transforms(joint_state)\n\n    def broadcast_transforms(self, joint_state):\n        # Base footprint to base link transform\n        t = TransformStamped()\n        t.header.stamp = self.get_clock().now().to_msg()\n        t.header.frame_id = 'odom'\n        t.child_frame_id = 'base_footprint'\n\n        # Simulate robot movement in a circle\n        t.transform.translation.x = math.sin(self.time * 0.5) * 2.0\n        t.transform.translation.y = math.cos(self.time * 0.5) * 2.0\n        t.transform.translation.z = 0.0\n\n        # Calculate orientation for facing direction of movement\n        angle = self.time * 0.5 + math.pi/2\n        t.transform.rotation.x = 0.0\n        t.transform.rotation.y = 0.0\n        t.transform.rotation.z = math.sin(angle/2)\n        t.transform.rotation.w = math.cos(angle/2)\n\n        self.tf_broadcaster.sendTransform(t)\n\n        # Base link to left wheel transform\n        t = TransformStamped()\n        t.header.stamp = self.get_clock().now().to_msg()\n        t.header.frame_id = 'base_link'\n        t.child_frame_id = 'left_wheel'\n\n        t.transform.translation.x = 0.15\n        t.transform.translation.y = 0.15\n        t.transform.translation.z = -0.1\n\n        # Apply wheel rotation\n        wheel_rotation = joint_state.position[0]\n        t.transform.rotation.x = math.sin(wheel_rotation/2) * math.sin(math.pi/2)\n        t.transform.rotation.y = math.sin(wheel_rotation/2) * 0.0\n        t.transform.rotation.z = math.sin(wheel_rotation/2) * math.cos(math.pi/2)\n        t.transform.rotation.w = math.cos(wheel_rotation/2)\n\n        self.tf_broadcaster.sendTransform(t)\n\n        # Base link to right wheel transform\n        t = TransformStamped()\n        t.header.stamp = self.get_clock().now().to_msg()\n        t.header.frame_id = 'base_link'\n        t.child_frame_id = 'right_wheel'\n\n        t.transform.translation.x = 0.15\n        t.transform.translation.y = -0.15\n        t.transform.translation.z = -0.1\n\n        # Apply wheel rotation\n        wheel_rotation = joint_state.position[1]\n        t.transform.rotation.x = math.sin(wheel_rotation/2) * math.sin(math.pi/2)\n        t.transform.rotation.y = math.sin(wheel_rotation/2) * 0.0\n        t.transform.rotation.z = math.sin(wheel_rotation/2) * math.cos(math.pi/2)\n        t.transform.rotation.w = math.cos(wheel_rotation/2)\n\n        self.tf_broadcaster.sendTransform(t)\n\n        # Base link to camera transform\n        t = TransformStamped()\n        t.header.stamp = self.get_clock().now().to_msg()\n        t.header.frame_id = 'base_link'\n        t.child_frame_id = 'camera_link'\n\n        t.transform.translation.x = 0.2\n        t.transform.translation.y = 0.0\n        t.transform.translation.z = 0.05\n\n        t.transform.rotation.x = 0.0\n        t.transform.rotation.y = 0.0\n        t.transform.rotation.z = 0.0\n        t.transform.rotation.w = 1.0\n\n        self.tf_broadcaster.sendTransform(t)\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = RobotStatePublisher()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(t.h2,{id:"exercise-3-create-joint-state-publisher",children:"Exercise 3: Create Joint State Publisher"}),"\n",(0,r.jsx)(t.h3,{id:"step-1-create-a-separate-joint-state-publisher",children:"Step 1: Create a separate joint state publisher"}),"\n",(0,r.jsxs)(t.p,{children:["Create ",(0,r.jsx)(t.code,{children:"~/ros2_ws/src/robot_state_py/robot_state_py/joint_state_publisher.py"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"#!/usr/bin/env python3\n# joint_state_publisher.py\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState\nimport math\n\n\nclass JointStatePublisher(Node):\n    def __init__(self):\n        super().__init__('joint_state_publisher')\n\n        # Create publisher for joint states\n        self.publisher = self.create_publisher(JointState, 'joint_states', 10)\n\n        # Create timer to publish joint states\n        timer_period = 0.05  # 20 Hz\n        self.timer = self.create_timer(timer_period, self.publish_joint_states)\n\n        # Initialize time\n        self.time = 0.0\n\n        self.get_logger().info('Joint State Publisher started')\n\n    def publish_joint_states(self):\n        # Create joint state message\n        msg = JointState()\n        msg.header.stamp = self.get_clock().now().to_msg()\n        msg.header.frame_id = 'base_link'\n\n        # Set joint names\n        msg.name = ['left_wheel_joint', 'right_wheel_joint']\n\n        # Simulate joint positions (oscillating wheels)\n        self.time += 0.05\n        left_pos = math.sin(self.time) * 0.5\n        right_pos = math.cos(self.time) * 0.5\n\n        # Set positions, velocities, and efforts\n        msg.position = [left_pos, right_pos]\n        msg.velocity = [math.cos(self.time) * 0.5, -math.sin(self.time) * 0.5]\n        msg.effort = [0.0, 0.0]\n\n        # Publish joint states\n        self.publisher.publish(msg)\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = JointStatePublisher()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(t.h2,{id:"exercise-4-tf-transform-utilities",children:"Exercise 4: TF Transform Utilities"}),"\n",(0,r.jsx)(t.h3,{id:"step-1-create-tf-listener-and-transform-utilities",children:"Step 1: Create TF listener and transform utilities"}),"\n",(0,r.jsxs)(t.p,{children:["Create ",(0,r.jsx)(t.code,{children:"~/ros2_ws/src/robot_state_py/robot_state_py/tf_utils.py"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"#!/usr/bin/env python3\n# tf_utils.py\nimport rclpy\nfrom rclpy.node import Node\nfrom tf2_ros import TransformListener, Buffer\nfrom geometry_msgs.msg import TransformStamped\nfrom tf2_geometry_msgs import PointStamped\nimport tf2_ros\n\n\nclass TFUtils(Node):\n    def __init__(self):\n        super().__init__('tf_utils')\n\n        # Create TF buffer and listener\n        self.tf_buffer = Buffer()\n        self.tf_listener = TransformListener(self.tf_buffer, self)\n\n        # Create timer to perform TF operations\n        timer_period = 1.0  # 1 Hz\n        self.timer = self.create_timer(timer_period, self.perform_tf_operations)\n\n        self.get_logger().info('TF Utilities node started')\n\n    def perform_tf_operations(self):\n        try:\n            # Lookup transform from base_link to camera_link\n            trans = self.tf_buffer.lookup_transform(\n                'base_link',\n                'camera_link',\n                rclpy.time.Time()\n            )\n\n            self.get_logger().info(\n                f'Camera position relative to base: '\n                f'x={trans.transform.translation.x:.2f}, '\n                f'y={trans.transform.translation.y:.2f}, '\n                f'z={trans.transform.translation.z:.2f}'\n            )\n\n            # Transform a point from camera frame to base frame\n            point_camera = PointStamped()\n            point_camera.header.frame_id = 'camera_link'\n            point_camera.header.stamp = self.get_clock().now().to_msg()\n            point_camera.point.x = 1.0  # 1m in front of camera\n            point_camera.point.y = 0.0\n            point_camera.point.z = 0.0\n\n            # Transform the point to base frame\n            point_base = self.tf_buffer.transform(point_camera, 'base_link')\n\n            self.get_logger().info(\n                f'Point in base frame: '\n                f'x={point_base.point.x:.2f}, '\n                f'y={point_base.point.y:.2f}, '\n                f'z={point_base.point.z:.2f}'\n            )\n\n        except tf2_ros.TransformException as ex:\n            self.get_logger().info(f'Could not transform: {ex}')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = TFUtils()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(t.h2,{id:"exercise-5-urdf-robot-state-publisher-integration",children:"Exercise 5: URDF Robot State Publisher Integration"}),"\n",(0,r.jsx)(t.h3,{id:"step-1-create-a-urdf-based-robot-state-publisher",children:"Step 1: Create a URDF-based robot state publisher"}),"\n",(0,r.jsxs)(t.p,{children:["Create ",(0,r.jsx)(t.code,{children:"~/ros2_ws/src/robot_state_py/robot_state_py/urdf_robot_publisher.py"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"#!/usr/bin/env python3\n# urdf_robot_publisher.py\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState\nfrom geometry_msgs.msg import TransformStamped\nfrom tf2_ros import TransformBroadcaster\nfrom rcl_interfaces.msg import ParameterDescriptor\nimport math\n\n\nclass URDFRobotPublisher(Node):\n    def __init__(self):\n        super().__init__('urdf_robot_publisher')\n\n        # Declare parameters\n        self.declare_parameter(\n            'robot_description',\n            '<robot name=\"simple_robot\">...</robot>',\n            ParameterDescriptor(description='Robot URDF description')\n        )\n\n        # Create publisher for joint states\n        self.joint_state_publisher = self.create_publisher(\n            JointState, 'joint_states', 10\n        )\n\n        # Create transform broadcaster\n        self.tf_broadcaster = TransformBroadcaster(self)\n\n        # Create timer to publish states\n        timer_period = 0.05  # 20 Hz\n        self.timer = self.create_timer(timer_period, self.publish_states)\n\n        # Initialize joint positions\n        self.time = 0.0\n\n        # Joint names for our robot\n        self.joint_names = ['left_wheel_joint', 'right_wheel_joint']\n\n        self.get_logger().info('URDF Robot Publisher started')\n\n    def publish_states(self):\n        # Create joint state message\n        joint_state = JointState()\n        joint_state.header.stamp = self.get_clock().now().to_msg()\n        joint_state.header.frame_id = 'base_footprint'\n\n        # Set joint names\n        joint_state.name = self.joint_names\n\n        # Simulate joint movement\n        self.time += 0.05\n        left_wheel_pos = math.sin(self.time) * 0.5\n        right_wheel_pos = math.cos(self.time) * 0.5\n\n        # Set joint positions, velocities, and efforts\n        joint_state.position = [left_wheel_pos, right_wheel_pos]\n        joint_state.velocity = [math.cos(self.time) * 0.5, -math.sin(self.time) * 0.5]\n        joint_state.effort = [0.0, 0.0]\n\n        # Publish joint states\n        self.joint_state_publisher.publish(joint_state)\n\n        # Broadcast transforms\n        self.broadcast_transforms(joint_state)\n\n    def broadcast_transforms(self, joint_state):\n        # Odom to base_footprint transform (robot moving in a circle)\n        t = TransformStamped()\n        t.header.stamp = self.get_clock().now().to_msg()\n        t.header.frame_id = 'odom'\n        t.child_frame_id = 'base_footprint'\n\n        # Simulate robot movement\n        t.transform.translation.x = math.sin(self.time * 0.3) * 3.0\n        t.transform.translation.y = math.cos(self.time * 0.3) * 3.0\n        t.transform.translation.z = 0.0\n\n        # Calculate orientation\n        angle = self.time * 0.3 + math.pi/2\n        t.transform.rotation.x = 0.0\n        t.transform.rotation.y = 0.0\n        t.transform.rotation.z = math.sin(angle/2)\n        t.transform.rotation.w = math.cos(angle/2)\n\n        self.tf_broadcaster.sendTransform(t)\n\n        # Base_footprint to base_link transform\n        t = TransformStamped()\n        t.header.stamp = self.get_clock().now().to_msg()\n        t.header.frame_id = 'base_footprint'\n        t.child_frame_id = 'base_link'\n\n        t.transform.translation.x = 0.0\n        t.transform.translation.y = 0.0\n        t.transform.translation.z = 0.1  # Base link is 0.1m above footprint\n\n        t.transform.rotation.x = 0.0\n        t.transform.rotation.y = 0.0\n        t.transform.rotation.z = 0.0\n        t.transform.rotation.w = 1.0\n\n        self.tf_broadcaster.sendTransform(t)\n\n        # Base link to left wheel\n        t = TransformStamped()\n        t.header.stamp = self.get_clock().now().to_msg()\n        t.header.frame_id = 'base_link'\n        t.child_frame_id = 'left_wheel'\n\n        t.transform.translation.x = 0.15\n        t.transform.translation.y = 0.15\n        t.transform.translation.z = -0.1\n\n        # Apply wheel rotation\n        wheel_rotation = joint_state.position[0]\n        t.transform.rotation.x = math.sin(wheel_rotation/2) * math.sin(math.pi/2)\n        t.transform.rotation.y = math.sin(wheel_rotation/2) * 0.0\n        t.transform.rotation.z = math.sin(wheel_rotation/2) * math.cos(math.pi/2)\n        t.transform.rotation.w = math.cos(wheel_rotation/2)\n\n        self.tf_broadcaster.sendTransform(t)\n\n        # Base link to right wheel\n        t = TransformStamped()\n        t.header.stamp = self.get_clock().now().to_msg()\n        t.header.frame_id = 'base_link'\n        t.child_frame_id = 'right_wheel'\n\n        t.transform.translation.x = 0.15\n        t.transform.translation.y = -0.15\n        t.transform.translation.z = -0.1\n\n        # Apply wheel rotation\n        wheel_rotation = joint_state.position[1]\n        t.transform.rotation.x = math.sin(wheel_rotation/2) * math.sin(math.pi/2)\n        t.transform.rotation.y = math.sin(wheel_rotation/2) * 0.0\n        t.transform.rotation.z = math.sin(wheel_rotation/2) * math.cos(math.pi/2)\n        t.transform.rotation.w = math.cos(wheel_rotation/2)\n\n        self.tf_broadcaster.sendTransform(t)\n\n        # Base link to camera\n        t = TransformStamped()\n        t.header.stamp = self.get_clock().now().to_msg()\n        t.header.frame_id = 'base_link'\n        t.child_frame_id = 'camera_link'\n\n        t.transform.translation.x = 0.2\n        t.transform.translation.y = 0.0\n        t.transform.translation.z = 0.05\n\n        t.transform.rotation.x = 0.0\n        t.transform.rotation.y = 0.0\n        t.transform.rotation.z = 0.0\n        t.transform.rotation.w = 1.0\n\n        self.tf_broadcaster.sendTransform(t)\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = URDFRobotPublisher()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(t.h2,{id:"exercise-6-update-setuppy",children:"Exercise 6: Update setup.py"}),"\n",(0,r.jsxs)(t.p,{children:["Edit ",(0,r.jsx)(t.code,{children:"~/ros2_ws/src/robot_state_py/setup.py"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"from setuptools import setup\nimport os\nfrom glob import glob\n\npackage_name = 'robot_state_py'\n\nsetup(\n    name=package_name,\n    version='0.0.0',\n    packages=[package_name],\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n        (os.path.join('share', package_name, 'urdf'), glob('urdf/*.urdf')),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='Your Name',\n    maintainer_email='your.email@example.com',\n    description='Robot state management examples',\n    license='Apache License 2.0',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'robot_state_publisher = robot_state_py.robot_state_publisher:main',\n            'joint_state_publisher = robot_state_py.joint_state_publisher:main',\n            'tf_utils = robot_state_py.tf_utils:main',\n            'urdf_robot_publisher = robot_state_py.urdf_robot_publisher:main',\n        ],\n    },\n)\n"})}),"\n",(0,r.jsx)(t.h2,{id:"exercise-7-build-and-test-the-robot-state-system",children:"Exercise 7: Build and Test the Robot State System"}),"\n",(0,r.jsx)(t.h3,{id:"step-1-build-the-package",children:"Step 1: Build the package"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select robot_state_py\n"})}),"\n",(0,r.jsx)(t.h3,{id:"step-2-source-the-workspace",children:"Step 2: Source the workspace"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\n"})}),"\n",(0,r.jsx)(t.h3,{id:"step-3-launch-the-robot-state-publisher",children:"Step 3: Launch the robot state publisher"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"ros2 run robot_state_py urdf_robot_publisher\n"})}),"\n",(0,r.jsx)(t.h3,{id:"step-4-in-another-terminal-check-the-joint-states",children:"Step 4: In another terminal, check the joint states"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\nros2 topic echo /joint_states\n"})}),"\n",(0,r.jsx)(t.h3,{id:"step-5-check-the-tf-tree",children:"Step 5: Check the TF tree"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\nros2 run tf2_tools view_frames\n"})}),"\n",(0,r.jsx)(t.p,{children:"This will generate a PDF showing the current TF tree structure."}),"\n",(0,r.jsx)(t.h3,{id:"step-6-use-tf-echo-to-check-specific-transforms",children:"Step 6: Use TF echo to check specific transforms"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\nros2 run tf2_ros tf2_echo odom base_link\n"})}),"\n",(0,r.jsx)(t.h2,{id:"exercise-8-robot-state-visualization",children:"Exercise 8: Robot State Visualization"}),"\n",(0,r.jsx)(t.h3,{id:"step-1-create-a-visualization-node",children:"Step 1: Create a visualization node"}),"\n",(0,r.jsxs)(t.p,{children:["Create ",(0,r.jsx)(t.code,{children:"~/ros2_ws/src/robot_state_py/robot_state_py/robot_visualizer.py"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"#!/usr/bin/env python3\n# robot_visualizer.py\nimport rclpy\nfrom rclpy.node import Node\nfrom visualization_msgs.msg import Marker, MarkerArray\nfrom geometry_msgs.msg import Point\nfrom std_msgs.msg import ColorRGBA\nimport math\n\n\nclass RobotVisualizer(Node):\n    def __init__(self):\n        super().__init__('robot_visualizer')\n\n        # Create publisher for visualization markers\n        self.marker_pub = self.create_publisher(MarkerArray, 'robot_markers', 10)\n\n        # Create timer to publish markers\n        timer_period = 0.1  # 10 Hz\n        self.timer = self.create_timer(timer_period, self.publish_markers)\n\n        self.get_logger().info('Robot Visualizer started')\n\n    def publish_markers(self):\n        marker_array = MarkerArray()\n\n        # Robot body marker\n        body_marker = Marker()\n        body_marker.header.frame_id = 'base_link'\n        body_marker.header.stamp = self.get_clock().now().to_msg()\n        body_marker.ns = 'robot'\n        body_marker.id = 0\n        body_marker.type = Marker.CUBE\n        body_marker.action = Marker.ADD\n        body_marker.pose.position.x = 0.0\n        body_marker.pose.position.y = 0.0\n        body_marker.pose.position.z = 0.0\n        body_marker.pose.orientation.x = 0.0\n        body_marker.pose.orientation.y = 0.0\n        body_marker.pose.orientation.z = 0.0\n        body_marker.pose.orientation.w = 1.0\n        body_marker.scale.x = 0.5\n        body_marker.scale.y = 0.3\n        body_marker.scale.z = 0.2\n        body_marker.color.a = 0.8\n        body_marker.color.r = 0.0\n        body_marker.color.g = 0.0\n        body_marker.color.b = 1.0\n        marker_array.markers.append(body_marker)\n\n        # Left wheel marker\n        left_wheel_marker = Marker()\n        left_wheel_marker.header.frame_id = 'left_wheel'\n        left_wheel_marker.header.stamp = self.get_clock().now().to_msg()\n        left_wheel_marker.ns = 'robot'\n        left_wheel_marker.id = 1\n        left_wheel_marker.type = Marker.CYLINDER\n        left_wheel_marker.action = Marker.ADD\n        left_wheel_marker.pose.position.x = 0.0\n        left_wheel_marker.pose.position.y = 0.0\n        left_wheel_marker.pose.position.z = 0.0\n        left_wheel_marker.pose.orientation.x = 0.0\n        left_wheel_marker.pose.orientation.y = 0.0\n        left_wheel_marker.pose.orientation.z = 0.0\n        left_wheel_marker.pose.orientation.w = 1.0\n        left_wheel_marker.scale.x = 0.2\n        left_wheel_marker.scale.y = 0.2\n        left_wheel_marker.scale.z = 0.05\n        left_wheel_marker.color.a = 0.8\n        left_wheel_marker.color.r = 0.0\n        left_wheel_marker.color.g = 0.0\n        left_wheel_marker.color.b = 0.0\n        marker_array.markers.append(left_wheel_marker)\n\n        # Right wheel marker\n        right_wheel_marker = Marker()\n        right_wheel_marker.header.frame_id = 'right_wheel'\n        right_wheel_marker.header.stamp = self.get_clock().now().to_msg()\n        right_wheel_marker.ns = 'robot'\n        right_wheel_marker.id = 2\n        right_wheel_marker.type = Marker.CYLINDER\n        right_wheel_marker.action = Marker.ADD\n        right_wheel_marker.pose.position.x = 0.0\n        right_wheel_marker.pose.position.y = 0.0\n        right_wheel_marker.pose.position.z = 0.0\n        right_wheel_marker.pose.orientation.x = 0.0\n        right_wheel_marker.pose.orientation.y = 0.0\n        right_wheel_marker.pose.orientation.z = 0.0\n        right_wheel_marker.pose.orientation.w = 1.0\n        right_wheel_marker.scale.x = 0.2\n        right_wheel_marker.scale.y = 0.2\n        right_wheel_marker.scale.z = 0.05\n        right_wheel_marker.color.a = 0.8\n        right_wheel_marker.color.r = 0.0\n        right_wheel_marker.color.g = 0.0\n        right_wheel_marker.color.b = 0.0\n        marker_array.markers.append(right_wheel_marker)\n\n        # Camera marker\n        camera_marker = Marker()\n        camera_marker.header.frame_id = 'camera_link'\n        camera_marker.header.stamp = self.get_clock().now().to_msg()\n        camera_marker.ns = 'robot'\n        camera_marker.id = 3\n        camera_marker.type = Marker.CUBE\n        camera_marker.action = Marker.ADD\n        camera_marker.pose.position.x = 0.0\n        camera_marker.pose.position.y = 0.0\n        camera_marker.pose.position.z = 0.0\n        camera_marker.pose.orientation.x = 0.0\n        camera_marker.pose.orientation.y = 0.0\n        camera_marker.pose.orientation.z = 0.0\n        camera_marker.pose.orientation.w = 1.0\n        camera_marker.scale.x = 0.05\n        camera_marker.scale.y = 0.05\n        camera_marker.scale.z = 0.05\n        camera_marker.color.a = 0.8\n        camera_marker.color.r = 1.0\n        camera_marker.color.g = 0.0\n        camera_marker.color.b = 0.0\n        marker_array.markers.append(camera_marker)\n\n        # Publish marker array\n        self.marker_pub.publish(marker_array)\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = RobotVisualizer()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(t.p,{children:"Update the setup.py to include the visualizer:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"entry_points={\n    'console_scripts': [\n        'robot_state_publisher = robot_state_py.robot_state_publisher:main',\n        'joint_state_publisher = robot_state_py.joint_state_publisher:main',\n        'tf_utils = robot_state_py.tf_utils:main',\n        'urdf_robot_publisher = robot_state_py.urdf_robot_publisher:main',\n        'robot_visualizer = robot_state_py.robot_visualizer:main',\n    ],\n},\n"})}),"\n",(0,r.jsx)(t.p,{children:"Rebuild the package:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select robot_state_py\nsource ~/ros2_ws/install/setup.bash\n"})}),"\n",(0,r.jsx)(t.h2,{id:"exercise-9-testing-with-rviz2",children:"Exercise 9: Testing with RViz2"}),"\n",(0,r.jsx)(t.h3,{id:"step-1-launch-the-robot-state-publisher-and-visualizer",children:"Step 1: Launch the robot state publisher and visualizer"}),"\n",(0,r.jsx)(t.p,{children:"Terminal 1:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\nros2 run robot_state_py urdf_robot_publisher\n"})}),"\n",(0,r.jsx)(t.p,{children:"Terminal 2:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\nros2 run robot_state_py robot_visualizer\n"})}),"\n",(0,r.jsx)(t.h3,{id:"step-2-launch-rviz2-to-visualize-the-robot",children:"Step 2: Launch RViz2 to visualize the robot"}),"\n",(0,r.jsx)(t.p,{children:"Terminal 3:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\nrviz2\n"})}),"\n",(0,r.jsx)(t.p,{children:"In RViz2:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:'Set the "Fixed Frame" to "odom"'}),"\n",(0,r.jsx)(t.li,{children:'Add a "RobotModel" display and set the description topic to "robot_description" (if using robot state publisher)'}),"\n",(0,r.jsx)(t.li,{children:'Add a "TF" display to visualize the transform tree'}),"\n",(0,r.jsx)(t.li,{children:'Add a "MarkerArray" display and set the topic to "/robot_markers"'}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(t.h3,{id:"common-issues-and-solutions",children:"Common Issues and Solutions"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"TF tree not showing up"}),":"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Ensure transform broadcaster is properly initialized"}),"\n",(0,r.jsx)(t.li,{children:"Check that frame names are consistent"}),"\n",(0,r.jsx)(t.li,{children:"Verify that timestamps are current"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Joint states not updating"}),":"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Check that joint names in the message match URDF"}),"\n",(0,r.jsx)(t.li,{children:"Verify that the joint state publisher is running"}),"\n",(0,r.jsx)(t.li,{children:"Ensure proper frame relationships"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"RViz2 not displaying robot"}),":"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Verify that robot_description parameter is set"}),"\n",(0,r.jsx)(t.li,{children:"Check that joint states are being published"}),"\n",(0,r.jsx)(t.li,{children:"Ensure proper TF relationships"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Transform lookup failures"}),":"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Increase TF buffer size if looking up old transforms"}),"\n",(0,r.jsx)(t.li,{children:"Ensure transforms are being broadcasted regularly"}),"\n",(0,r.jsx)(t.li,{children:"Check for circular dependencies in TF tree"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"assessment-questions",children:"Assessment Questions"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"What is the purpose of the TF tree in ROS 2?"}),"\n",(0,r.jsx)(t.li,{children:"How do joint states and transforms work together to represent robot state?"}),"\n",(0,r.jsx)(t.li,{children:"What is the difference between robot_state_publisher and joint_state_publisher?"}),"\n",(0,r.jsx)(t.li,{children:"Why is it important to have a consistent TF tree structure?"}),"\n",(0,r.jsx)(t.li,{children:"How can you transform coordinates between different frames?"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"extension-exercises",children:"Extension Exercises"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Create a robot with more complex kinematics (e.g., a robotic arm)"}),"\n",(0,r.jsx)(t.li,{children:"Implement forward kinematics to calculate end-effector position"}),"\n",(0,r.jsx)(t.li,{children:"Add sensor frames to the TF tree (IMU, camera, LiDAR)"}),"\n",(0,r.jsx)(t.li,{children:"Create a node that publishes robot state based on odometry input"}),"\n",(0,r.jsx)(t.li,{children:"Implement inverse kinematics for a simple 2-DOF arm"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(t.p,{children:"In this lab, you successfully:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Implemented robot state publishers for broadcasting transforms"}),"\n",(0,r.jsx)(t.li,{children:"Created joint state publishers for tracking joint positions"}),"\n",(0,r.jsx)(t.li,{children:"Used TF tools for debugging and visualization"}),"\n",(0,r.jsx)(t.li,{children:"Integrated robot state management with URDF models"}),"\n",(0,r.jsx)(t.li,{children:"Transformed coordinates between different frames"}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"These skills are fundamental to robotics development, as proper state management is crucial for navigation, manipulation, perception, and control systems. The TF tree provides a unified way to understand spatial relationships in the robot's environment, while joint states enable precise control and monitoring of the robot's configuration."})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>i});var r=n(6540);const s={},a=r.createContext(s);function o(e){const t=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);