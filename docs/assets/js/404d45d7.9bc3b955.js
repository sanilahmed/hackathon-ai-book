"use strict";(globalThis.webpackChunkphysical_ai_book=globalThis.webpackChunkphysical_ai_book||[]).push([[8297],{4546:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>t,metadata:()=>a,toc:()=>l});var r=s(4848),i=s(8453);const t={},o="Lab 1.2: ROS 2 Services and Actions",a={id:"modules/lab-exercises/lab-1-2-ros2-services-actions",title:"Lab 1.2: ROS 2 Services and Actions",description:"Overview",source:"@site/docs/modules/lab-exercises/lab-1-2-ros2-services-actions.md",sourceDirName:"modules/lab-exercises",slug:"/modules/lab-exercises/lab-1-2-ros2-services-actions",permalink:"/ai-robotic-book/modules/lab-exercises/lab-1-2-ros2-services-actions",draft:!1,unlisted:!1,editUrl:"https://github.com/your-org/physical-ai-book/tree/main/docs/modules/lab-exercises/lab-1-2-ros2-services-actions.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Lab 1.1: ROS 2 Environment Setup and Basic Nodes",permalink:"/ai-robotic-book/modules/lab-exercises/lab-1-1-ros2-setup"},next:{title:"Lab 1.3: Robot State Management",permalink:"/ai-robotic-book/modules/lab-exercises/lab-1-3-robot-state-management"}},c={},l=[{value:"Overview",id:"overview",level:2},{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Duration",id:"duration",level:2},{value:"Exercise 1: Creating a ROS 2 Service",id:"exercise-1-creating-a-ros-2-service",level:2},{value:"Step 1: Create a new package for services",id:"step-1-create-a-new-package-for-services",level:3},{value:"Step 2: Create a custom service definition",id:"step-2-create-a-custom-service-definition",level:3},{value:"Step 3: Create a service server",id:"step-3-create-a-service-server",level:3},{value:"Step 4: Create a service client",id:"step-4-create-a-service-client",level:3},{value:"Step 5: Update setup.py for services",id:"step-5-update-setuppy-for-services",level:3},{value:"Step 6: Update package.xml for services",id:"step-6-update-packagexml-for-services",level:3},{value:"Exercise 2: Creating a ROS 2 Action",id:"exercise-2-creating-a-ros-2-action",level:2},{value:"Step 1: Create a new package for actions",id:"step-1-create-a-new-package-for-actions",level:3},{value:"Step 2: Create a custom action definition",id:"step-2-create-a-custom-action-definition",level:3},{value:"Step 3: Create an action server",id:"step-3-create-an-action-server",level:3},{value:"Step 4: Create an action client",id:"step-4-create-an-action-client",level:3},{value:"Step 5: Update setup.py for actions",id:"step-5-update-setuppy-for-actions",level:3},{value:"Step 6: Update package.xml for actions",id:"step-6-update-packagexml-for-actions",level:3},{value:"Exercise 3: Build and Test Services",id:"exercise-3-build-and-test-services",level:2},{value:"Step 1: Build the packages",id:"step-1-build-the-packages",level:3},{value:"Step 2: Source the workspace",id:"step-2-source-the-workspace",level:3},{value:"Step 3: Test the service",id:"step-3-test-the-service",level:3},{value:"Step 4: Test the action",id:"step-4-test-the-action",level:3},{value:"Exercise 4: Using ROS 2 Tools for Services and Actions",id:"exercise-4-using-ros-2-tools-for-services-and-actions",level:2},{value:"Step 1: List services",id:"step-1-list-services",level:3},{value:"Step 2: Get service information",id:"step-2-get-service-information",level:3},{value:"Step 3: Call service directly from command line",id:"step-3-call-service-directly-from-command-line",level:3},{value:"Step 4: List actions",id:"step-4-list-actions",level:3},{value:"Step 5: Get action information",id:"step-5-get-action-information",level:3},{value:"Exercise 5: Robot Control Service Example",id:"exercise-5-robot-control-service-example",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues and Solutions",id:"common-issues-and-solutions",level:3},{value:"Assessment Questions",id:"assessment-questions",level:2},{value:"Extension Exercises",id:"extension-exercises",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"lab-12-ros-2-services-and-actions",children:"Lab 1.2: ROS 2 Services and Actions"}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"In this lab, you will learn about ROS 2 services and actions, which provide synchronous request/response communication and goal-oriented asynchronous communication respectively. You'll implement custom services and actions and understand when to use each communication pattern."}),"\n",(0,r.jsx)(n.h2,{id:"objectives",children:"Objectives"}),"\n",(0,r.jsx)(n.p,{children:"By the end of this lab, you will be able to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Implement ROS 2 services for request/response communication"}),"\n",(0,r.jsx)(n.li,{children:"Create and use ROS 2 actions for goal-oriented tasks"}),"\n",(0,r.jsx)(n.li,{children:"Understand the differences between topics, services, and actions"}),"\n",(0,r.jsx)(n.li,{children:"Choose the appropriate communication pattern for different scenarios"}),"\n",(0,r.jsx)(n.li,{children:"Debug and monitor services and actions using ROS 2 tools"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Completion of Lab 1.1: ROS 2 Environment Setup and Basic Nodes"}),"\n",(0,r.jsx)(n.li,{children:"Understanding of ROS 2 topics and messages"}),"\n",(0,r.jsx)(n.li,{children:"Basic Python programming skills"}),"\n",(0,r.jsx)(n.li,{children:"Familiarity with ROS 2 workspace setup"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"duration",children:"Duration"}),"\n",(0,r.jsx)(n.p,{children:"2 hours"}),"\n",(0,r.jsx)(n.h2,{id:"exercise-1-creating-a-ros-2-service",children:"Exercise 1: Creating a ROS 2 Service"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-a-new-package-for-services",children:"Step 1: Create a new package for services"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src\nros2 pkg create --build-type ament_python robot_services_py --dependencies rclpy std_msgs example_interfaces\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-create-a-custom-service-definition",children:"Step 2: Create a custom service definition"}),"\n",(0,r.jsx)(n.p,{children:"Create the service directory:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/ros2_ws/src/robot_services_py/robot_services_py/srv\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/robot_services_py/robot_services_py/srv/AddTwoInts.srv"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"int64 a\nint64 b\n---\nint64 sum\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-create-a-service-server",children:"Step 3: Create a service server"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/robot_services_py/robot_services_py/add_two_ints_server.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n# add_two_ints_server.py\nimport rclpy\nfrom rclpy.node import Node\nfrom robot_services_py.srv import AddTwoInts\n\n\nclass AddTwoIntsServer(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_server')\n        self.srv = self.create_service(\n            AddTwoInts,\n            'add_two_ints',\n            self.add_two_ints_callback\n        )\n        self.get_logger().info('Add Two Ints Server started')\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Request received: {request.a} + {request.b} = {response.sum}')\n        return response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    add_two_ints_server = AddTwoIntsServer()\n\n    try:\n        rclpy.spin(add_two_ints_server)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        add_two_ints_server.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-4-create-a-service-client",children:"Step 4: Create a service client"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/robot_services_py/robot_services_py/add_two_ints_client.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n# add_two_ints_client.py\nimport sys\nimport rclpy\nfrom rclpy.node import Node\nfrom robot_services_py.srv import AddTwoInts\n\n\nclass AddTwoIntsClient(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_client')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n        self.req = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.cli.call_async(self.req)\n        rclpy.spin_until_future_complete(self, self.future)\n        return self.future.result()\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    client = AddTwoIntsClient()\n\n    # Get arguments from command line\n    if len(sys.argv) != 3:\n        print('Usage: python3 add_two_ints_client.py <int1> <int2>')\n        return\n\n    a = int(sys.argv[1])\n    b = int(sys.argv[2])\n\n    print(f'Requesting {a} + {b}')\n    response = client.send_request(a, b)\n    print(f'Result: {a} + {b} = {response.sum}')\n\n    client.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-5-update-setuppy-for-services",children:"Step 5: Update setup.py for services"}),"\n",(0,r.jsxs)(n.p,{children:["Edit ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/robot_services_py/setup.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from setuptools import setup\nimport os\nfrom glob import glob\n\npackage_name = 'robot_services_py'\n\nsetup(\n    name=package_name,\n    version='0.0.0',\n    packages=[package_name],\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n        (os.path.join('share', package_name, 'srv'), glob('srv/*.srv')),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='Your Name',\n    maintainer_email='your.email@example.com',\n    description='ROS 2 services example',\n    license='Apache License 2.0',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'add_two_ints_server = robot_services_py.add_two_ints_server:main',\n            'add_two_ints_client = robot_services_py.add_two_ints_client:main',\n        ],\n    },\n)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-6-update-packagexml-for-services",children:"Step 6: Update package.xml for services"}),"\n",(0,r.jsxs)(n.p,{children:["Edit ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/robot_services_py/package.xml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\n<package format="3">\n  <name>robot_services_py</name>\n  <version>0.0.0</version>\n  <description>ROS 2 services example</description>\n  <maintainer email="your.email@example.com">Your Name</maintainer>\n  <license>Apache License 2.0</license>\n\n  <depend>rclpy</depend>\n  <depend>std_msgs</depend>\n  <depend>example_interfaces</depend>\n\n  <test_depend>ament_copyright</test_depend>\n  <test_depend>ament_flake8</test_depend>\n  <test_depend>ament_pep257</test_depend>\n  <test_depend>python3-pytest</test_depend>\n\n  <export>\n    <build_type>ament_python</build_type>\n  </export>\n</package>\n'})}),"\n",(0,r.jsx)(n.h2,{id:"exercise-2-creating-a-ros-2-action",children:"Exercise 2: Creating a ROS 2 Action"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-a-new-package-for-actions",children:"Step 1: Create a new package for actions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws/src\nros2 pkg create --build-type ament_python robot_actions_py --dependencies rclpy std_msgs action_tutorials_interfaces\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-create-a-custom-action-definition",children:"Step 2: Create a custom action definition"}),"\n",(0,r.jsx)(n.p,{children:"Create the action directory:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/ros2_ws/src/robot_actions_py/robot_actions_py/action\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/robot_actions_py/robot_actions_py/action/Fibonacci.action"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"int32 order\n---\nint32[] sequence\n---\nint32 feedback\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-create-an-action-server",children:"Step 3: Create an action server"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/robot_actions_py/robot_actions_py/fibonacci_action_server.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n# fibonacci_action_server.py\nimport time\nimport rclpy\nfrom rclpy.action import ActionServer, CancelResponse, GoalResponse\nfrom rclpy.node import Node\nfrom robot_actions_py.action import Fibonacci\n\n\nclass FibonacciActionServer(Node):\n    def __init__(self):\n        super().__init__('fibonacci_action_server')\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            'fibonacci',\n            execute_callback=self.execute_callback,\n            goal_callback=self.goal_callback,\n            cancel_callback=self.cancel_callback\n        )\n        self.get_logger().info('Fibonacci Action Server started')\n\n    def goal_callback(self, goal_request):\n        \"\"\"Accept or reject a client request to begin an action.\"\"\"\n        self.get_logger().info('Received goal request')\n        return GoalResponse.ACCEPT\n\n    def cancel_callback(self, goal_handle):\n        \"\"\"Accept or reject a client request to cancel an action.\"\"\"\n        self.get_logger().info('Received cancel request')\n        return CancelResponse.ACCEPT\n\n    async def execute_callback(self, goal_handle):\n        \"\"\"Execute the goal.\"\"\"\n        self.get_logger().info('Executing goal...')\n\n        # Create feedback message\n        feedback_msg = Fibonacci.Feedback()\n        feedback_msg.feedback = 0\n\n        # Generate Fibonacci sequence\n        sequence = [0, 1]\n\n        for i in range(1, goal_handle.request.order):\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info('Goal canceled')\n                return Fibonacci.Result()\n\n            feedback_msg.feedback = i\n            goal_handle.publish_feedback(feedback_msg)\n\n            sequence.append(sequence[i] + sequence[i-1])\n            time.sleep(0.5)  # Simulate work\n\n        goal_handle.succeed()\n        result = Fibonacci.Result()\n        result.sequence = sequence\n\n        self.get_logger().info(f'Result: {sequence}')\n        return result\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    fibonacci_action_server = FibonacciActionServer()\n\n    try:\n        rclpy.spin(fibonacci_action_server)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        fibonacci_action_server.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-4-create-an-action-client",children:"Step 4: Create an action client"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/robot_actions_py/robot_actions_py/fibonacci_action_client.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n# fibonacci_action_client.py\nimport sys\nimport rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\nfrom robot_actions_py.action import Fibonacci\n\n\nclass FibonacciActionClient(Node):\n    def __init__(self):\n        super().__init__('fibonacci_action_client')\n        self._action_client = ActionClient(\n            self,\n            Fibonacci,\n            'fibonacci'\n        )\n\n    def send_goal(self, order):\n        goal_msg = Fibonacci.Goal()\n        goal_msg.order = order\n\n        self.get_logger().info('Waiting for action server...')\n        self._action_client.wait_for_server()\n\n        self.get_logger().info(f'Sending goal with order: {order}')\n        send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback\n        )\n\n        send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().info('Goal rejected :(')\n            return\n\n        self.get_logger().info('Goal accepted :)')\n        get_result_future = goal_handle.get_result_async()\n        get_result_future.add_done_callback(self.get_result_callback)\n\n    def get_result_callback(self, future):\n        result = future.result().result\n        self.get_logger().info(f'Result: {result.sequence}')\n        rclpy.shutdown()\n\n    def feedback_callback(self, feedback_msg):\n        feedback = feedback_msg.feedback\n        self.get_logger().info(f'Received feedback: {feedback.feedback}')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    action_client = FibonacciActionClient()\n\n    if len(sys.argv) != 2:\n        print('Usage: python3 fibonacci_action_client.py <order>')\n        return\n\n    order = int(sys.argv[1])\n    action_client.send_goal(order)\n\n    rclpy.spin(action_client)\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-5-update-setuppy-for-actions",children:"Step 5: Update setup.py for actions"}),"\n",(0,r.jsxs)(n.p,{children:["Edit ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/robot_actions_py/setup.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from setuptools import setup\nimport os\nfrom glob import glob\n\npackage_name = 'robot_actions_py'\n\nsetup(\n    name=package_name,\n    version='0.0.0',\n    packages=[package_name],\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n        (os.path.join('share', package_name, 'action'), glob('action/*.action')),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='Your Name',\n    maintainer_email='your.email@example.com',\n    description='ROS 2 actions example',\n    license='Apache License 2.0',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'fibonacci_action_server = robot_actions_py.fibonacci_action_server:main',\n            'fibonacci_action_client = robot_actions_py.fibonacci_action_client:main',\n        ],\n    },\n)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-6-update-packagexml-for-actions",children:"Step 6: Update package.xml for actions"}),"\n",(0,r.jsxs)(n.p,{children:["Edit ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/robot_actions_py/package.xml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\n<package format="3">\n  <name>robot_actions_py</name>\n  <version>0.0.0</version>\n  <description>ROS 2 actions example</description>\n  <maintainer email="your.email@example.com">Your Name</maintainer>\n  <license>Apache License 2.0</license>\n\n  <depend>rclpy</depend>\n  <depend>std_msgs</depend>\n  <depend>action_tutorials_interfaces</depend>\n\n  <test_depend>ament_copyright</test_depend>\n  <test_depend>ament_flake8</test_depend>\n  <test_depend>ament_pep257</test_depend>\n  <test_depend>python3-pytest</test_depend>\n\n  <export>\n    <build_type>ament_python</build_type>\n  </export>\n</package>\n'})}),"\n",(0,r.jsx)(n.h2,{id:"exercise-3-build-and-test-services",children:"Exercise 3: Build and Test Services"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-build-the-packages",children:"Step 1: Build the packages"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select robot_services_py robot_actions_py\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-source-the-workspace",children:"Step 2: Source the workspace"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-test-the-service",children:"Step 3: Test the service"}),"\n",(0,r.jsx)(n.p,{children:"Open a new terminal and run the service server:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\nros2 run robot_services_py add_two_ints_server\n"})}),"\n",(0,r.jsx)(n.p,{children:"In another terminal, run the service client:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\nros2 run robot_services_py add_two_ints_client 5 3\n"})}),"\n",(0,r.jsx)(n.p,{children:"You should see the server respond with the sum of 5 and 3."}),"\n",(0,r.jsx)(n.h3,{id:"step-4-test-the-action",children:"Step 4: Test the action"}),"\n",(0,r.jsx)(n.p,{children:"Open a new terminal and run the action server:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\nros2 run robot_actions_py fibonacci_action_server\n"})}),"\n",(0,r.jsx)(n.p,{children:"In another terminal, run the action client:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\nros2 run robot_actions_py fibonacci_action_client 5\n"})}),"\n",(0,r.jsx)(n.p,{children:"You should see the action server generate a Fibonacci sequence and provide feedback during execution."}),"\n",(0,r.jsx)(n.h2,{id:"exercise-4-using-ros-2-tools-for-services-and-actions",children:"Exercise 4: Using ROS 2 Tools for Services and Actions"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-list-services",children:"Step 1: List services"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\nros2 service list\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-get-service-information",children:"Step 2: Get service information"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 service info /add_two_ints\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-call-service-directly-from-command-line",children:"Step 3: Call service directly from command line"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'ros2 service call /add_two_ints robot_services_py/srv/AddTwoInts "{a: 10, b: 20}"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"step-4-list-actions",children:"Step 4: List actions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 action list\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-5-get-action-information",children:"Step 5: Get action information"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 action info /fibonacci\n"})}),"\n",(0,r.jsx)(n.h2,{id:"exercise-5-robot-control-service-example",children:"Exercise 5: Robot Control Service Example"}),"\n",(0,r.jsx)(n.p,{children:"Create a more practical service for robot control:"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/robot_services_py/robot_services_py/srv/RobotControl.srv"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"string command\nfloat64[] parameters\n---\nbool success\nstring message\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"~/ros2_ws/src/robot_services_py/robot_services_py/robot_control_server.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n# robot_control_server.py\nimport rclpy\nfrom rclpy.node import Node\nfrom robot_services_py.srv import RobotControl\n\n\nclass RobotControlServer(Node):\n    def __init__(self):\n        super().__init__('robot_control_server')\n        self.srv = self.create_service(\n            RobotControl,\n            'robot_control',\n            self.robot_control_callback\n        )\n        self.get_logger().info('Robot Control Server started')\n\n    def robot_control_callback(self, request, response):\n        command = request.command\n        params = request.parameters\n\n        self.get_logger().info(f'Received command: {command} with params: {params}')\n\n        # Process different commands\n        if command == 'move_to':\n            if len(params) >= 2:\n                x, y = params[0], params[1]\n                response.success = True\n                response.message = f'Moving to position ({x}, {y})'\n            else:\n                response.success = False\n                response.message = 'Move command requires 2 parameters (x, y)'\n        elif command == 'rotate':\n            if len(params) >= 1:\n                angle = params[0]\n                response.success = True\n                response.message = f'Rotating by {angle} radians'\n            else:\n                response.success = False\n                response.message = 'Rotate command requires 1 parameter (angle)'\n        elif command == 'stop':\n            response.success = True\n            response.message = 'Robot stopped'\n        else:\n            response.success = False\n            response.message = f'Unknown command: {command}'\n\n        return response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    robot_control_server = RobotControlServer()\n\n    try:\n        rclpy.spin(robot_control_server)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        robot_control_server.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Update the entry points in ",(0,r.jsx)(n.code,{children:"setup.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"entry_points={\n    'console_scripts': [\n        'add_two_ints_server = robot_services_py.add_two_ints_server:main',\n        'add_two_ints_client = robot_services_py.add_two_ints_client:main',\n        'robot_control_server = robot_services_py.robot_control_server:main',\n    ],\n},\n"})}),"\n",(0,r.jsx)(n.p,{children:"Build and test the robot control service:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select robot_services_py\nsource ~/ros2_ws/install/setup.bash\nros2 run robot_services_py robot_control_server\n"})}),"\n",(0,r.jsx)(n.p,{children:"In another terminal:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"source ~/ros2_ws/install/setup.bash\nros2 service call /robot_control robot_services_py/srv/RobotControl \"{command: 'move_to', parameters: [1.0, 2.0]}\"\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"common-issues-and-solutions",children:"Common Issues and Solutions"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Service/Action not found errors"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ensure the service/action server is running"}),"\n",(0,r.jsx)(n.li,{children:"Check that the service/action name matches exactly"}),"\n",(0,r.jsx)(n.li,{children:"Verify that the correct message/action type is used"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Build errors with custom messages/actions"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Make sure the .srv/.action files are in the correct directory"}),"\n",(0,r.jsx)(n.li,{children:"Verify that package.xml includes the rosidl dependencies"}),"\n",(0,r.jsx)(n.li,{children:"Check that setup.py includes the message/action files in data_files"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Client hangs when calling service"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Verify that the service server is running"}),"\n",(0,r.jsx)(n.li,{children:"Check network configuration if using multiple machines"}),"\n",(0,r.jsx)(n.li,{children:"Ensure both nodes are on the same ROS domain"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Action client doesn't receive feedback"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Check that the action server is publishing feedback"}),"\n",(0,r.jsx)(n.li,{children:"Verify that the feedback callback is properly implemented"}),"\n",(0,r.jsx)(n.li,{children:"Ensure the action server is not completing too quickly"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"assessment-questions",children:"Assessment Questions"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"What is the main difference between ROS 2 topics, services, and actions?"}),"\n",(0,r.jsx)(n.li,{children:"When would you use a service instead of a topic for communication?"}),"\n",(0,r.jsx)(n.li,{children:"What are the three parts of an action definition?"}),"\n",(0,r.jsx)(n.li,{children:"How does an action client receive feedback during execution?"}),"\n",(0,r.jsx)(n.li,{children:"What are the advantages of using actions over services for long-running tasks?"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"extension-exercises",children:"Extension Exercises"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Create a service that controls a robot's LED lights (on/off, color, blinking pattern)"}),"\n",(0,r.jsx)(n.li,{children:"Implement an action that moves a robot to multiple waypoints with feedback on progress"}),"\n",(0,r.jsx)(n.li,{children:"Create a service that queries robot battery status and other sensor readings"}),"\n",(0,r.jsx)(n.li,{children:"Implement a complex action with preemption (ability to cancel and start a new goal)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"In this lab, you successfully:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Created and implemented ROS 2 services for request/response communication"}),"\n",(0,r.jsx)(n.li,{children:"Developed ROS 2 actions for goal-oriented tasks with feedback"}),"\n",(0,r.jsx)(n.li,{children:"Built and tested both services and actions"}),"\n",(0,r.jsx)(n.li,{children:"Used ROS 2 tools to monitor and interact with services and actions"}),"\n",(0,r.jsx)(n.li,{children:"Created practical examples for robot control"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"These communication patterns are essential for building complex robotic systems where different types of interactions are needed. Services are ideal for immediate responses to queries or commands, while actions are perfect for long-running tasks that require feedback and the ability to cancel."}),"\n",(0,r.jsx)(n.p,{children:"The skills learned in this lab will be crucial as you develop more sophisticated robotic applications that require coordinated behavior between multiple nodes and systems."})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);