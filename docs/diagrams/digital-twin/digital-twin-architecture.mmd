# Digital Twin Architecture

## System Architecture

```mermaid
graph TB
    subgraph "ROS 2 Ecosystem"
        A[ROS 2 Nodes] --> B[Robot State Publisher]
        C[Controller Manager] --> B
        D[Joint State Publisher] --> B
    end

    subgraph "Gazebo Simulation"
        E[Gazebo Physics Engine] --> F[Sensor Plugins]
        G[Robot Model SDF] --> E
        H[World Definition] --> E
    end

    subgraph "Unity Visualization"
        I[Unity Scene] --> J[Robot Model Hierarchy]
        K[Perception Package] --> J
        L[Camera Sensors] --> K
    end

    subgraph "Bridge Layer"
        M[Gazebo-ROS Bridge] --> N[Unity-ROS Bridge]
    end

    A <--> M
    E <--> M
    I <--> N

    style A fill:#e1f5fe
    style E fill:#f3e5f5
    style I fill:#e8f5e8
    style M fill:#fff3e0
```

## Data Flow

```mermaid
sequenceDiagram
    participant R as ROS 2
    participant G as Gazebo
    participant U as Unity
    participant C as Controller

    R->>G: Joint Commands
    G->>R: Joint States
    G->>U: Sensor Data
    U->>R: Perception Data
    R->>C: Control Commands
    C->>R: Feedback
```

## Sensor Integration

```mermaid
graph LR
    subgraph "Physical Sensors"
        A[LiDAR] --> B[Range Data]
        C[Camera] --> D[Image Data]
        E[IMU] --> F[Orientation Data]
    end

    subgraph "Simulation Sensors"
        G[Gazebo LiDAR] --> B
        H[Gazebo Camera] --> D
        I[Gazebo IMU] --> F
    end

    subgraph "Unity Sensors"
        J[Unity LiDAR] --> B
        K[Unity Camera] --> D
        L[Unity IMU] --> F
    end

    B --> R[ROS 2 Topics]
    D --> R
    F --> R
```