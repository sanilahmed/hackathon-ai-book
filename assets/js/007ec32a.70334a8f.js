"use strict";(globalThis.webpackChunkphysical_ai_book=globalThis.webpackChunkphysical_ai_book||[]).push([[1142],{432(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var s=t(4848),i=t(8453);const r={sidebar_label:"Lab 1.3: Robot State Management"},a="Lab Exercise 1.3: Robot State Management in ROS 2",o={id:"modules/lab-exercises/lab-1-3-robot-state-management",title:"Lab Exercise 1.3: Robot State Management in ROS 2",description:"This lab exercise covers managing robot states in ROS 2, including joint states, transforms, and robot state publishing.",source:"@site/docs/modules/lab-exercises/lab-1-3-robot-state-management.md",sourceDirName:"modules/lab-exercises",slug:"/modules/lab-exercises/lab-1-3-robot-state-management",permalink:"/hackathon-ai-book/modules/lab-exercises/lab-1-3-robot-state-management",draft:!1,unlisted:!1,editUrl:"https://github.com/sanilahmed/hackathon-ai-book/tree/main/docs/modules/lab-exercises/lab-1-3-robot-state-management.md",tags:[],version:"current",frontMatter:{sidebar_label:"Lab 1.3: Robot State Management"},sidebar:"tutorialSidebar",previous:{title:"Lab 1.2: Services and Actions",permalink:"/hackathon-ai-book/modules/lab-exercises/lab-1-2-ros2-services-actions"},next:{title:"References",permalink:"/hackathon-ai-book/modules/ros2-nervous-system/references"}},l={},d=[{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Robot State Overview",id:"robot-state-overview",level:2},{value:"Robot State Publisher",id:"robot-state-publisher",level:2},{value:"Implementation",id:"implementation",level:3},{value:"TF (Transforms) System",id:"tf-transforms-system",level:2},{value:"Understanding TF",id:"understanding-tf",level:3},{value:"Creating TF Publishers",id:"creating-tf-publishers",level:3},{value:"Working with URDF",id:"working-with-urdf",level:2},{value:"URDF Integration",id:"urdf-integration",level:3},{value:"Example URDF Integration",id:"example-urdf-integration",level:3},{value:"Visualization",id:"visualization",level:2},{value:"Using RViz2",id:"using-rviz2",level:3},{value:"Command-line Tools",id:"command-line-tools",level:3},{value:"Advanced State Management",id:"advanced-state-management",level:2},{value:"Robot State Server",id:"robot-state-server",level:3},{value:"State Estimation",id:"state-estimation",level:3},{value:"Exercise Tasks",id:"exercise-tasks",level:2},{value:"Summary",id:"summary",level:2}];function m(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"lab-exercise-13-robot-state-management-in-ros-2",children:"Lab Exercise 1.3: Robot State Management in ROS 2"}),"\n",(0,s.jsx)(n.p,{children:"This lab exercise covers managing robot states in ROS 2, including joint states, transforms, and robot state publishing."}),"\n",(0,s.jsx)(n.h2,{id:"objectives",children:"Objectives"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Understand the robot state representation in ROS 2"}),"\n",(0,s.jsx)(n.li,{children:"Implement a robot state publisher"}),"\n",(0,s.jsx)(n.li,{children:"Work with TF transforms"}),"\n",(0,s.jsx)(n.li,{children:"Monitor and visualize robot states"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"ROS 2 Humble Hawksbill installed"}),"\n",(0,s.jsx)(n.li,{children:"Basic knowledge of URDF"}),"\n",(0,s.jsx)(n.li,{children:"Completed Lab 1.1 and 1.2"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"robot-state-overview",children:"Robot State Overview"}),"\n",(0,s.jsx)(n.p,{children:"The robot state includes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Joint positions, velocities, and efforts"}),"\n",(0,s.jsx)(n.li,{children:"Transform relationships between links"}),"\n",(0,s.jsx)(n.li,{children:"End-effector poses"}),"\n",(0,s.jsx)(n.li,{children:"Sensor states"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"robot-state-publisher",children:"Robot State Publisher"}),"\n",(0,s.jsx)(n.h3,{id:"implementation",children:"Implementation"}),"\n",(0,s.jsx)(n.p,{children:"Create a robot state publisher node:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:'#include "rclcpp/rclcpp.hpp"\n#include "sensor_msgs/msg/joint_state.hpp"\n#include "tf2_msgs/msg/tf_message.hpp"\n#include "geometry_msgs/msg/transform_stamped.hpp"\n#include <vector>\n#include <string>\n\nclass RobotStatePublisher : public rclcpp::Node\n{\npublic:\n    RobotStatePublisher()\n    : Node("robot_state_publisher")\n    {\n        joint_pub_ = this->create_publisher<sensor_msgs::msg::JointState>("joint_states", 10);\n        tf_pub_ = this->create_publisher<tf2_msgs::msg::TFMessage>("tf", 10);\n\n        timer_ = this->create_wall_timer(\n            50ms, std::bind(&RobotStatePublisher::publish_states, this));\n    }\n\nprivate:\n    void publish_states()\n    {\n        // Create joint state message\n        auto joint_msg = sensor_msgs::msg::JointState();\n        joint_msg.header.stamp = this->now();\n        joint_msg.name = {"joint1", "joint2", "joint3"};\n        joint_msg.position = {0.1, 0.2, 0.3};\n        joint_msg.velocity = {0.0, 0.0, 0.0};\n        joint_msg.effort = {0.0, 0.0, 0.0};\n\n        joint_pub_->publish(joint_msg);\n\n        // Create TF transforms\n        tf2_msgs::msg::TFMessage tf_msg;\n        geometry_msgs::msg::TransformStamped transform;\n        transform.header.stamp = this->now();\n        transform.header.frame_id = "base_link";\n        transform.child_frame_id = "link1";\n        transform.transform.translation.x = 0.1;\n        transform.transform.translation.y = 0.0;\n        transform.transform.translation.z = 0.1;\n        transform.transform.rotation.x = 0.0;\n        transform.transform.rotation.y = 0.0;\n        transform.transform.rotation.z = 0.0;\n        transform.transform.rotation.w = 1.0;\n\n        tf_msg.transforms.push_back(transform);\n        tf_pub_->publish(tf_msg);\n    }\n\n    rclcpp::Publisher<sensor_msgs::msg::JointState>::SharedPtr joint_pub_;\n    rclcpp::Publisher<tf2_msgs::msg::TFMessage>::SharedPtr tf_pub_;\n    rclcpp::TimerBase::SharedPtr timer_;\n};\n'})}),"\n",(0,s.jsx)(n.h2,{id:"tf-transforms-system",children:"TF (Transforms) System"}),"\n",(0,s.jsx)(n.h3,{id:"understanding-tf",children:"Understanding TF"}),"\n",(0,s.jsx)(n.p,{children:"The TF system manages coordinate frame relationships:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Static transforms (unchanging)"}),"\n",(0,s.jsx)(n.li,{children:"Dynamic transforms (changing over time)"}),"\n",(0,s.jsx)(n.li,{children:"Transform trees for complex robots"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"creating-tf-publishers",children:"Creating TF Publishers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom tf2_ros import TransformBroadcaster\nfrom geometry_msgs.msg import TransformStamped\n\nclass DynamicTfBroadcaster(Node):\n    def __init__(self):\n        super().__init__('dynamic_tf_broadcaster')\n        self.tf_broadcaster = TransformBroadcaster(self)\n\n        self.timer = self.create_timer(0.1, self.broadcast_transform)\n        self.offset = 0\n\n    def broadcast_transform(self):\n        t = TransformStamped()\n\n        t.header.stamp = self.get_clock().now().to_msg()\n        t.header.frame_id = 'turtle1'\n        t.child_frame_id = 'carrot1'\n\n        # Define transform with changing values\n        t.transform.translation.x = 10 * math.sin(self.offset)\n        t.transform.translation.y = 10 * math.cos(self.offset)\n        t.transform.translation.z = 0.0\n        t.transform.rotation.x = 0.0\n        t.transform.rotation.y = 0.0\n        t.transform.rotation.z = 0.0\n        t.transform.rotation.w = 1.0\n\n        self.tf_broadcaster.sendTransform(t)\n        self.offset += 0.05\n"})}),"\n",(0,s.jsx)(n.h2,{id:"working-with-urdf",children:"Working with URDF"}),"\n",(0,s.jsx)(n.h3,{id:"urdf-integration",children:"URDF Integration"}),"\n",(0,s.jsx)(n.p,{children:"The robot state publisher works with URDF files to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Publish joint states to TF"}),"\n",(0,s.jsx)(n.li,{children:"Maintain kinematic chains"}),"\n",(0,s.jsx)(n.li,{children:"Provide collision information"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"example-urdf-integration",children:"Example URDF Integration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<robot name="my_robot">\n  <link name="base_link">\n    <visual>\n      <geometry>\n        <cylinder length="0.6" radius="0.2"/>\n      </geometry>\n    </visual>\n  </link>\n\n  <joint name="base_to_wheel" type="continuous">\n    <parent link="base_link"/>\n    <child link="wheel_link"/>\n    <origin xyz="0 0.25 0" rpy="0 0 0"/>\n    <axis xyz="0 1 0"/>\n  </joint>\n\n  <link name="wheel_link">\n    <visual>\n      <geometry>\n        <cylinder length="0.1" radius="0.1"/>\n      </geometry>\n    </visual>\n  </link>\n</robot>\n'})}),"\n",(0,s.jsx)(n.h2,{id:"visualization",children:"Visualization"}),"\n",(0,s.jsx)(n.h3,{id:"using-rviz2",children:"Using RViz2"}),"\n",(0,s.jsx)(n.p,{children:"Visualize robot states in RViz2:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Add RobotModel display"}),"\n",(0,s.jsx)(n.li,{children:"Set Fixed Frame to robot's base frame"}),"\n",(0,s.jsx)(n.li,{children:"Set Robot Description to your URDF parameter"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"command-line-tools",children:"Command-line Tools"}),"\n",(0,s.jsx)(n.p,{children:"Monitor robot states:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# View joint states\nros2 topic echo /joint_states\n\n# View transforms\nros2 run tf2_tools view_frames\n\n# Check transform tree\nros2 run tf2_ros tf2_echo base_link tool0\n"})}),"\n",(0,s.jsx)(n.h2,{id:"advanced-state-management",children:"Advanced State Management"}),"\n",(0,s.jsx)(n.h3,{id:"robot-state-server",children:"Robot State Server"}),"\n",(0,s.jsx)(n.p,{children:"For complex robots, use the robot state server:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Maintains complete robot state"}),"\n",(0,s.jsx)(n.li,{children:"Provides state queries"}),"\n",(0,s.jsx)(n.li,{children:"Handles multiple joint state sources"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"state-estimation",children:"State Estimation"}),"\n",(0,s.jsx)(n.p,{children:"Implement state estimation for:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Sensor fusion"}),"\n",(0,s.jsx)(n.li,{children:"Kalman filtering"}),"\n",(0,s.jsx)(n.li,{children:"Particle filtering"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"exercise-tasks",children:"Exercise Tasks"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create a URDF for a simple 3-DOF robot arm"}),"\n",(0,s.jsx)(n.li,{children:"Implement a robot state publisher that publishes joint states"}),"\n",(0,s.jsx)(n.li,{children:"Create TF broadcasters for dynamic transforms"}),"\n",(0,s.jsx)(n.li,{children:"Visualize the robot in RViz2"}),"\n",(0,s.jsx)(n.li,{children:"Add sensor data integration to the state publisher"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"In this lab, you learned to manage robot states in ROS 2, including joint states, transforms, and visualization. You implemented state publishers and learned to work with URDF files for complete robot representation."})]})}function c(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>o});var s=t(6540);const i={},r=s.createContext(i);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);