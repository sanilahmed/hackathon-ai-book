"use strict";(globalThis.webpackChunkphysical_ai_book=globalThis.webpackChunkphysical_ai_book||[]).push([[2815],{529(n,e,i){i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>r,default:()=>m,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var t=i(4848),o=i(8453);const s={sidebar_label:"Lab 2.3: Unity Robotics Integration"},r="Lab Exercise 2.3: Unity Robotics Integration",a={id:"modules/lab-exercises/lab-2-3-unity-robotics-integration",title:"Lab Exercise 2.3: Unity Robotics Integration",description:"This lab exercise covers integrating Unity with ROS 2 for digital twin applications.",source:"@site/docs/modules/lab-exercises/lab-2-3-unity-robotics-integration.md",sourceDirName:"modules/lab-exercises",slug:"/modules/lab-exercises/lab-2-3-unity-robotics-integration",permalink:"/hackathon-ai-book/modules/lab-exercises/lab-2-3-unity-robotics-integration",draft:!1,unlisted:!1,editUrl:"https://github.com/sanilahmed/hackathon-ai-book/tree/main/docs/modules/lab-exercises/lab-2-3-unity-robotics-integration.md",tags:[],version:"current",frontMatter:{sidebar_label:"Lab 2.3: Unity Robotics Integration"},sidebar:"tutorialSidebar",previous:{title:"Lab 2.2: Robot Model Integration",permalink:"/hackathon-ai-book/modules/lab-exercises/lab-2-2-robot-model-integration"},next:{title:"Lab 2.4: Multi-Environment Synchronization",permalink:"/hackathon-ai-book/modules/lab-exercises/lab-2-4-multi-environment-synchronization"}},l={},c=[{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Unity Robotics Setup",id:"unity-robotics-setup",level:2},{value:"Installation",id:"installation",level:3},{value:"ROS-TCP-Connector Setup",id:"ros-tcp-connector-setup",level:3},{value:"Basic ROS Connection",id:"basic-ros-connection",level:3},{value:"URDF Import",id:"urdf-import",level:2},{value:"Importing Robot Models",id:"importing-robot-models",level:3},{value:"Custom URDF Import Script",id:"custom-urdf-import-script",level:3},{value:"Unity-ROS Communication",id:"unity-ros-communication",level:2},{value:"Publisher Implementation",id:"publisher-implementation",level:3},{value:"Subscriber Implementation",id:"subscriber-implementation",level:3},{value:"Digital Twin Environment",id:"digital-twin-environment",level:2},{value:"Creating the Environment",id:"creating-the-environment",level:3},{value:"Environment Synchronization",id:"environment-synchronization",level:3},{value:"ROS 2 Bridge Setup",id:"ros-2-bridge-setup",level:2},{value:"ROS 2 Node for Bridge",id:"ros-2-node-for-bridge",level:3},{value:"Testing the Integration",id:"testing-the-integration",level:2},{value:"Setup Steps",id:"setup-steps",level:3},{value:"Verification Commands",id:"verification-commands",level:3},{value:"Exercise Tasks",id:"exercise-tasks",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Debugging Tips",id:"debugging-tips",level:3},{value:"Summary",id:"summary",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h1,{id:"lab-exercise-23-unity-robotics-integration",children:"Lab Exercise 2.3: Unity Robotics Integration"}),"\n",(0,t.jsx)(e.p,{children:"This lab exercise covers integrating Unity with ROS 2 for digital twin applications."}),"\n",(0,t.jsx)(e.h2,{id:"objectives",children:"Objectives"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Set up Unity with ROS-TCP-Connector"}),"\n",(0,t.jsx)(e.li,{children:"Import robot models from URDF"}),"\n",(0,t.jsx)(e.li,{children:"Implement basic communication between Unity and ROS 2"}),"\n",(0,t.jsx)(e.li,{children:"Create a simple digital twin environment"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Unity Hub and Unity 2022.3 LTS"}),"\n",(0,t.jsx)(e.li,{children:"ROS 2 Humble Hawksbill"}),"\n",(0,t.jsx)(e.li,{children:"Basic Unity knowledge"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"unity-robotics-setup",children:"Unity Robotics Setup"}),"\n",(0,t.jsx)(e.h3,{id:"installation",children:"Installation"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"Download and install Unity Hub"}),"\n",(0,t.jsx)(e.li,{children:"Install Unity 2022.3 LTS"}),"\n",(0,t.jsx)(e.li,{children:"Download Unity Robotics Hub from Unity's website"}),"\n",(0,t.jsxs)(e.li,{children:["Install the following packages:","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"ROS-TCP-Connector"}),"\n",(0,t.jsx)(e.li,{children:"Unity-Robotics-Helpers"}),"\n",(0,t.jsx)(e.li,{children:"URDF-Importer"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"ros-tcp-connector-setup",children:"ROS-TCP-Connector Setup"}),"\n",(0,t.jsx)(e.p,{children:"The ROS-TCP-Connector enables communication between Unity and ROS 2:"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"In Unity, go to Window \u2192 Package Manager"}),"\n",(0,t.jsx)(e.li,{children:"Install ROS-TCP-Connector"}),"\n",(0,t.jsx)(e.li,{children:"Add the ROSConnection prefab to your scene"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"basic-ros-connection",children:"Basic ROS Connection"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-csharp",children:'using UnityEngine;\nusing Unity.Robotics.ROSTCPConnector;\nusing RosMessageTypes.Std;\n\npublic class UnityROSConnection : MonoBehaviour\n{\n    ROSConnection ros;\n\n    void Start()\n    {\n        // Get the ROS connection object\n        ros = ROSConnection.GetOrCreateInstance();\n\n        // Set the IP address and port for ROS communication\n        ros.Initialize("127.0.0.1", 10000);\n    }\n\n    void Update()\n    {\n        // Send a message every second\n        if (Time.time % 1.0f < Time.deltaTime)\n        {\n            var message = new UInt8Msg((byte)1);\n            ros.Publish("unity_status", message);\n        }\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"urdf-import",children:"URDF Import"}),"\n",(0,t.jsx)(e.h3,{id:"importing-robot-models",children:"Importing Robot Models"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"Place your URDF file in Unity's Assets folder"}),"\n",(0,t.jsx)(e.li,{children:"Use the URDF Importer: GameObject \u2192 3D Object \u2192 URDF Robot"}),"\n",(0,t.jsx)(e.li,{children:"Select your URDF file"}),"\n",(0,t.jsx)(e.li,{children:"Configure import settings"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"custom-urdf-import-script",children:"Custom URDF Import Script"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-csharp",children:"using UnityEngine;\nusing Unity.Robotics.UrdfImporter;\n\npublic class CustomUrdfImporter : MonoBehaviour\n{\n    public string urdfPath;\n    public GameObject robotPrefab;\n\n    void Start()\n    {\n        if (!string.IsNullOrEmpty(urdfPath))\n        {\n            robotPrefab = UrdfRobotExtensions.CreateRobot(urdfPath);\n        }\n    }\n\n    public void ImportUrdf(string path)\n    {\n        if (robotPrefab != null)\n        {\n            DestroyImmediate(robotPrefab);\n        }\n        robotPrefab = UrdfRobotExtensions.CreateRobot(path);\n    }\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"unity-ros-communication",children:"Unity-ROS Communication"}),"\n",(0,t.jsx)(e.h3,{id:"publisher-implementation",children:"Publisher Implementation"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-csharp",children:'using UnityEngine;\nusing Unity.Robotics.ROSTCPConnector;\nusing RosMessageTypes.Sensor;\nusing RosMessageTypes.Geometry;\n\npublic class UnityPublisher : MonoBehaviour\n{\n    ROSConnection ros;\n    public GameObject robot;\n\n    void Start()\n    {\n        ros = ROSConnection.GetOrCreateInstance();\n        ros.RegisterPublisher<JointStateMsg>("unity_joint_states");\n        ros.RegisterPublisher<OdometryMsg>("unity_odom");\n    }\n\n    void Update()\n    {\n        // Publish joint states\n        PublishJointStates();\n\n        // Publish odometry\n        PublishOdometry();\n    }\n\n    void PublishJointStates()\n    {\n        var jointState = new JointStateMsg();\n        jointState.header.stamp = new TimeStamp(0, 0);\n        jointState.header.frame_id = "unity_base";\n\n        // Get joint positions from Unity\n        // This would depend on your robot structure\n        jointState.name = new string[] { "joint1", "joint2", "joint3" };\n        jointState.position = new double[] { 0.1, 0.2, 0.3 };\n\n        ros.Publish("unity_joint_states", jointState);\n    }\n\n    void PublishOdometry()\n    {\n        var odom = new OdometryMsg();\n        odom.header.stamp = new TimeStamp(0, 0);\n        odom.header.frame_id = "world";\n        odom.child_frame_id = "unity_base";\n\n        // Set position and orientation\n        odom.pose.pose.position = new Vector3Msg(robot.transform.position.x,\n                                               robot.transform.position.y,\n                                               robot.transform.position.z);\n        odom.pose.pose.orientation = new QuaternionMsg(robot.transform.rotation.x,\n                                                      robot.transform.rotation.y,\n                                                      robot.transform.rotation.z,\n                                                      robot.transform.rotation.w);\n\n        ros.Publish("unity_odom", odom);\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"subscriber-implementation",children:"Subscriber Implementation"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-csharp",children:'using UnityEngine;\nusing Unity.Robotics.ROSTCPConnector;\nusing RosMessageTypes.Sensor;\nusing RosMessageTypes.Geometry;\n\npublic class UnitySubscriber : MonoBehaviour\n{\n    public GameObject robot;\n    ROSConnection ros;\n\n    void Start()\n    {\n        ros = ROSConnection.GetOrCreateInstance();\n\n        // Subscribe to ROS topics\n        ros.Subscribe<JointStateMsg>("joint_states", OnJointStateReceived);\n        ros.Subscribe<TwistMsg>("cmd_vel", OnCmdVelReceived);\n    }\n\n    void OnJointStateReceived(JointStateMsg jointState)\n    {\n        // Update robot joints in Unity\n        for (int i = 0; i < jointState.name.Length && i < jointState.position.Length; i++)\n        {\n            UpdateJoint(jointState.name[i], jointState.position[i]);\n        }\n    }\n\n    void OnCmdVelReceived(TwistMsg cmdVel)\n    {\n        // Move robot based on velocity command\n        Vector3 movement = new Vector3((float)cmdVel.linear.x, 0, (float)cmdVel.linear.y);\n        robot.transform.Translate(movement * Time.deltaTime);\n    }\n\n    void UpdateJoint(string jointName, double position)\n    {\n        // Find the joint in the robot hierarchy\n        Transform joint = robot.transform.Find(jointName);\n        if (joint != null)\n        {\n            // Update joint position (this is simplified)\n            joint.localEulerAngles = new Vector3(0, 0, (float)position * Mathf.Rad2Deg);\n        }\n    }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"digital-twin-environment",children:"Digital Twin Environment"}),"\n",(0,t.jsx)(e.h3,{id:"creating-the-environment",children:"Creating the Environment"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"Create a new Unity scene"}),"\n",(0,t.jsx)(e.li,{children:"Set up the environment (floor, walls, objects)"}),"\n",(0,t.jsx)(e.li,{children:"Import and position your robot"}),"\n",(0,t.jsx)(e.li,{children:"Configure lighting and materials"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"environment-synchronization",children:"Environment Synchronization"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-csharp",children:"using UnityEngine;\nusing Unity.Robotics.ROSTCPConnector;\nusing RosMessageTypes.Std;\n\npublic class EnvironmentSync : MonoBehaviour\n{\n    ROSConnection ros;\n\n    void Start()\n    {\n        ros = ROSConnection.GetOrCreateInstance();\n        ros.Subscribe<StringMsg>(\"unity_environment_state\", OnEnvironmentState);\n    }\n\n    void OnEnvironmentState(StringMsg state)\n    {\n        // Update Unity environment based on ROS state\n        UpdateEnvironment(state.data);\n    }\n\n    void UpdateEnvironment(string state)\n    {\n        // Parse state string and update Unity objects\n        // For example, move objects, change colors, etc.\n        string[] parts = state.Split(',');\n        if (parts.Length >= 3)\n        {\n            float x = float.Parse(parts[0]);\n            float y = float.Parse(parts[1]);\n            float z = float.Parse(parts[2]);\n\n            // Move an object to the specified position\n            transform.position = new Vector3(x, y, z);\n        }\n    }\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"ros-2-bridge-setup",children:"ROS 2 Bridge Setup"}),"\n",(0,t.jsx)(e.h3,{id:"ros-2-node-for-bridge",children:"ROS 2 Node for Bridge"}),"\n",(0,t.jsx)(e.p,{children:"Create a ROS 2 node to bridge Unity and other ROS 2 nodes:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState\nfrom nav_msgs.msg import Odometry\nfrom geometry_msgs.msg import Twist\nfrom std_msgs.msg import String\nimport socket\nimport json\n\nclass UnityBridgeNode(Node):\n    def __init__(self):\n        super().__init__('unity_bridge')\n\n        # ROS 2 publishers and subscribers\n        self.joint_state_pub = self.create_publisher(JointState, 'unity_joint_states', 10)\n        self.odom_pub = self.create_publisher(Odometry, 'unity_odom', 10)\n        self.joint_state_sub = self.create_subscription(JointState, 'joint_states', self.joint_state_callback, 10)\n        self.cmd_vel_sub = self.create_subscription(Twist, 'cmd_vel', self.cmd_vel_callback, 10)\n\n        # Timer for publishing Unity data\n        self.timer = self.create_timer(0.1, self.publish_unity_data)\n\n        # Unity connection (TCP socket)\n        self.unity_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        self.unity_socket.connect(('localhost', 10000))\n\n    def joint_state_callback(self, msg):\n        # Forward joint states to Unity\n        unity_msg = {\n            'type': 'joint_states',\n            'data': {\n                'names': list(msg.name),\n                'positions': list(msg.position),\n                'velocities': list(msg.velocity),\n                'efforts': list(msg.effort)\n            }\n        }\n        self.send_to_unity(json.dumps(unity_msg))\n\n    def cmd_vel_callback(self, msg):\n        # Forward velocity commands to Unity\n        unity_msg = {\n            'type': 'cmd_vel',\n            'linear': {'x': msg.linear.x, 'y': msg.linear.y, 'z': msg.linear.z},\n            'angular': {'x': msg.angular.x, 'y': msg.angular.y, 'z': msg.angular.z}\n        }\n        self.send_to_unity(json.dumps(unity_msg))\n\n    def publish_unity_data(self):\n        # Receive data from Unity and publish to ROS 2\n        try:\n            data = self.unity_socket.recv(1024).decode('utf-8')\n            unity_data = json.loads(data)\n\n            if unity_data['type'] == 'joint_states':\n                # Publish joint states received from Unity\n                msg = JointState()\n                msg.name = unity_data['data']['names']\n                msg.position = unity_data['data']['positions']\n                self.joint_state_pub.publish(msg)\n        except Exception as e:\n            self.get_logger().error(f'Error receiving Unity data: {e}')\n\n    def send_to_unity(self, msg):\n        try:\n            self.unity_socket.send(msg.encode('utf-8'))\n        except Exception as e:\n            self.get_logger().error(f'Error sending to Unity: {e}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    unity_bridge = UnityBridgeNode()\n    rclpy.spin(unity_bridge)\n    unity_bridge.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,t.jsx)(e.h2,{id:"testing-the-integration",children:"Testing the Integration"}),"\n",(0,t.jsx)(e.h3,{id:"setup-steps",children:"Setup Steps"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Start ROS 2:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"source /opt/ros/humble/setup.bash\n"})}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Run the Unity bridge node:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"ros2 run my_robot_unity_bridge unity_bridge_node\n"})}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Start Unity with your scene"}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Verify communication between Unity and ROS 2"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"verification-commands",children:"Verification Commands"}),"\n",(0,t.jsx)(e.p,{children:"Check ROS 2 topics:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# List available topics\nros2 topic list\n\n# Echo Unity joint states\nros2 topic echo /unity_joint_states\n\n# Send joint commands to Unity\nros2 topic pub /joint_states sensor_msgs/msg/JointState \"name: ['joint1', 'joint2'] position: [0.5, -0.3]\"\n"})}),"\n",(0,t.jsx)(e.h2,{id:"exercise-tasks",children:"Exercise Tasks"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"Set up Unity with ROS-TCP-Connector"}),"\n",(0,t.jsx)(e.li,{children:"Import a simple robot model from URDF"}),"\n",(0,t.jsx)(e.li,{children:"Implement a publisher to send Unity robot state to ROS 2"}),"\n",(0,t.jsx)(e.li,{children:"Implement a subscriber to receive ROS 2 commands in Unity"}),"\n",(0,t.jsx)(e.li,{children:"Create a simple environment in Unity"}),"\n",(0,t.jsx)(e.li,{children:"Test bidirectional communication between Unity and ROS 2"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(e.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Connection failures"}),": Check IP addresses and ports"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Message format issues"}),": Verify message types match"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Performance problems"}),": Optimize update rates and data sizes"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"URDF import errors"}),": Check URDF file format and dependencies"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"debugging-tips",children:"Debugging Tips"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Use Unity's console for error messages"}),"\n",(0,t.jsxs)(e.li,{children:["Monitor ROS 2 topics with ",(0,t.jsx)(e.code,{children:"ros2 topic echo"})]}),"\n",(0,t.jsx)(e.li,{children:"Check network connectivity between Unity and ROS 2"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(e.p,{children:"In this lab, you learned to integrate Unity with ROS 2 for digital twin applications. You implemented bidirectional communication, imported robot models, and created a synchronized environment between Unity and ROS 2."})]})}function m(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},8453(n,e,i){i.d(e,{R:()=>r,x:()=>a});var t=i(6540);const o={},s=t.createContext(o);function r(n){const e=t.useContext(s);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:r(n.components),t.createElement(s.Provider,{value:e},n.children)}}}]);