"use strict";(globalThis.webpackChunkphysical_ai_book=globalThis.webpackChunkphysical_ai_book||[]).push([[8297],{4546(e,n,c){c.r(n),c.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>t,toc:()=>l});var i=c(4848),s=c(8453);const r={sidebar_label:"Lab 1.2: Services and Actions"},a="Lab Exercise 1.2: ROS 2 Services and Actions",t={id:"modules/lab-exercises/lab-1-2-ros2-services-actions",title:"Lab Exercise 1.2: ROS 2 Services and Actions",description:"This lab exercise covers services and actions in ROS 2.",source:"@site/docs/modules/lab-exercises/lab-1-2-ros2-services-actions.md",sourceDirName:"modules/lab-exercises",slug:"/modules/lab-exercises/lab-1-2-ros2-services-actions",permalink:"/hackathon-ai-book/modules/lab-exercises/lab-1-2-ros2-services-actions",draft:!1,unlisted:!1,editUrl:"https://github.com/sanilahmed/hackathon-ai-book/tree/main/docs/modules/lab-exercises/lab-1-2-ros2-services-actions.md",tags:[],version:"current",frontMatter:{sidebar_label:"Lab 1.2: Services and Actions"},sidebar:"tutorialSidebar",previous:{title:"Lab 1.1: ROS 2 Setup",permalink:"/hackathon-ai-book/modules/lab-exercises/lab-1-1-ros2-setup"},next:{title:"Lab 1.3: Robot State Management",permalink:"/hackathon-ai-book/modules/lab-exercises/lab-1-3-robot-state-management"}},o={},l=[{value:"Objectives",id:"objectives",level:2},{value:"Services",id:"services",level:2},{value:"Creating a Service Server",id:"creating-a-service-server",level:3},{value:"Creating a Service Client",id:"creating-a-service-client",level:3},{value:"Actions",id:"actions",level:2},{value:"Creating an Action Server",id:"creating-an-action-server",level:3},{value:"Command-line Tools",id:"command-line-tools",level:2},{value:"Working with Services",id:"working-with-services",level:3},{value:"Working with Actions",id:"working-with-actions",level:3},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"lab-exercise-12-ros-2-services-and-actions",children:"Lab Exercise 1.2: ROS 2 Services and Actions"}),"\n",(0,i.jsx)(n.p,{children:"This lab exercise covers services and actions in ROS 2."}),"\n",(0,i.jsx)(n.h2,{id:"objectives",children:"Objectives"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Understand the difference between topics, services, and actions"}),"\n",(0,i.jsx)(n.li,{children:"Create a ROS 2 service server and client"}),"\n",(0,i.jsx)(n.li,{children:"Create a ROS 2 action server and client"}),"\n",(0,i.jsx)(n.li,{children:"Use command-line tools to interact with services and actions"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"services",children:"Services"}),"\n",(0,i.jsx)(n.p,{children:"Services provide synchronous request/response communication in ROS 2."}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-service-server",children:"Creating a Service Server"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create a service definition file ",(0,i.jsx)(n.code,{children:"AddTwoInts.srv"})," in a ",(0,i.jsx)(n.code,{children:"srv"})," directory:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"int64 a\nint64 b\n---\nint64 sum\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Create a service server in C++:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'#include "rclcpp/rclcpp.hpp"\n#include "example_interfaces/srv/add_two_ints.hpp"\n#include <memory>\n\nvoid add(const std::shared_ptr<example_interfaces::srv::AddTwoInts::Request> request,\n        std::shared_ptr<example_interfaces::srv::AddTwoInts::Response> response)\n{\n    response->sum = request->a + request->b;\n    RCLCPP_INFO(rclcpp::get_logger("rclcpp"), "Incoming request: %ld + %ld = %ld",\n                request->a, request->b, response->sum);\n}\n\nint main(int argc, char **argv)\n{\n    rclcpp::init(argc, argv);\n\n    std::shared_ptr<rclcpp::Node> node = rclcpp::Node::make_shared("add_two_ints_server");\n\n    auto service = node->create_service<example_interfaces::srv::AddTwoInts>("add_two_ints", &add);\n    RCLCPP_INFO(rclcpp::get_logger("rclcpp"), "Ready to add two ints.");\n\n    rclcpp::spin(node);\n    rclcpp::shutdown();\n    return 0;\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-service-client",children:"Creating a Service Client"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'#include "rclcpp/rclcpp.hpp"\n#include "example_interfaces/srv/add_two_ints.hpp"\n#include <chrono>\n#include <memory>\n\nusing AddTwoInts = example_interfaces::srv::AddTwoInts;\n\nint main(int argc, char **argv)\n{\n    rclcpp::init(argc, argv);\n\n    std::shared_ptr<rclcpp::Node> node = rclcpp::Node::make_shared("add_two_ints_client");\n\n    auto client = node->create_client<AddTwoInts>("add_two_ints");\n\n    while (!client->wait_for_service(std::chrono::seconds(1))) {\n        if (!rclcpp::ok()) {\n            RCLCPP_ERROR(rclcpp::get_logger("rclcpp"), "Interrupted while waiting for the service. Exiting.");\n            return 0;\n        }\n        RCLCPP_INFO(rclcpp::get_logger("rclcpp"), "Service not available, waiting again...");\n    }\n\n    auto request = std::make_shared<AddTwoInts::Request>();\n    request->a = 2;\n    request->b = 3;\n\n    auto result = client->async_send_request(request);\n    if (rclcpp::spin_until_future_complete(node, result) == rclcpp::FutureReturnCode::SUCCESS) {\n        RCLCPP_INFO(rclcpp::get_logger("rclcpp"), "Result of add_two_ints: %ld", result.get()->sum);\n    } else {\n        RCLCPP_ERROR(rclcpp::get_logger("rclcpp"), "Failed to call service add_two_ints");\n    }\n\n    rclcpp::shutdown();\n    return 0;\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"actions",children:"Actions"}),"\n",(0,i.jsx)(n.p,{children:"Actions provide asynchronous goal-oriented communication with feedback."}),"\n",(0,i.jsx)(n.h3,{id:"creating-an-action-server",children:"Creating an Action Server"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'#include "rclcpp/rclcpp.hpp"\n#include "rclcpp_action/rclcpp_action.hpp"\n#include "example_interfaces/action/fibonacci.hpp"\n\nclass FibonacciActionServer : public rclcpp::Node\n{\npublic:\n    using Fibonacci = example_interfaces::action::Fibonacci;\n    using GoalHandleFibonacci = rclcpp_action::ServerGoalHandle<Fibonacci>;\n\n    explicit FibonacciActionServer(const rclcpp::NodeOptions & options = rclcpp::NodeOptions())\n    : Node("fibonacci_action_server", options)\n    {\n        using namespace std::placeholders;\n\n        this->action_server_ = rclcpp_action::create_server<Fibonacci>(\n            this,\n            "fibonacci",\n            std::bind(&FibonacciActionServer::handle_goal, this, _1, _2),\n            std::bind(&FibonacciActionServer::handle_cancel, this, _1),\n            std::bind(&FibonacciActionServer::handle_accepted, this, _1));\n    }\n\nprivate:\n    rclcpp_action::Server<Fibonacci>::SharedPtr action_server_;\n\n    rclcpp_action::GoalResponse handle_goal(\n        const rclcpp_action::GoalUUID & uuid,\n        std::shared_ptr<const Fibonacci::Goal> goal)\n    {\n        RCLCPP_INFO(this->get_logger(), "Received goal request with order %d", goal->order);\n        (void)uuid;\n        return rclcpp_action::GoalResponse::ACCEPT_AND_EXECUTE;\n    }\n\n    rclcpp_action::CancelResponse handle_cancel(\n        const std::shared_ptr<GoalHandleFibonacci> goal_handle)\n    {\n        RCLCPP_INFO(this->get_logger(), "Received request to cancel goal");\n        (void)goal_handle;\n        return rclcpp_action::CancelResponse::ACCEPT;\n    }\n\n    void handle_accepted(const std::shared_ptr<GoalHandleFibonacci> goal_handle)\n    {\n        using namespace std::placeholders;\n        std::thread{std::bind(&FibonacciActionServer::execute, this, _1), goal_handle}.detach();\n    }\n\n    void execute(const std::shared_ptr<GoalHandleFibonacci> goal_handle)\n    {\n        RCLCPP_INFO(this->get_logger(), "Executing goal");\n        rclcpp::Rate loop_rate(1);\n        const auto goal = goal_handle->get_goal();\n        auto feedback = std::make_shared<Fibonacci::Feedback>();\n        auto & sequence = feedback->sequence;\n        auto result = std::make_shared<Fibonacci::Result>();\n\n        sequence.push_back(0);\n        sequence.push_back(1);\n\n        for (int i = 1; (i < goal->order) && rclcpp::ok(); ++i) {\n            if (goal_handle->is_canceling()) {\n                result->sequence = sequence;\n                goal_handle->canceled(result);\n                RCLCPP_INFO(this->get_logger(), "Goal canceled");\n                return;\n            }\n\n            sequence.push_back(sequence[i] + sequence[i - 1]);\n            feedback->sequence = sequence;\n            goal_handle->publish_feedback(feedback);\n            RCLCPP_INFO(this->get_logger(), "Publishing feedback");\n\n            loop_rate.sleep();\n        }\n\n        if (rclcpp::ok()) {\n            result->sequence = sequence;\n            goal_handle->succeed(result);\n            RCLCPP_INFO(this->get_logger(), "Goal succeeded");\n        }\n    }\n};\n'})}),"\n",(0,i.jsx)(n.h2,{id:"command-line-tools",children:"Command-line Tools"}),"\n",(0,i.jsx)(n.h3,{id:"working-with-services",children:"Working with Services"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["List services: ",(0,i.jsx)(n.code,{children:"ros2 service list"})]}),"\n",(0,i.jsxs)(n.li,{children:["Get service type: ",(0,i.jsx)(n.code,{children:"ros2 service type <service_name>"})]}),"\n",(0,i.jsxs)(n.li,{children:["Call a service: ",(0,i.jsx)(n.code,{children:'ros2 service call /add_two_ints example_interfaces/srv/AddTwoInts "{a: 1, b: 2}"'})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"working-with-actions",children:"Working with Actions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["List actions: ",(0,i.jsx)(n.code,{children:"ros2 action list"})]}),"\n",(0,i.jsxs)(n.li,{children:["Get action type: ",(0,i.jsx)(n.code,{children:"ros2 action type <action_name>"})]}),"\n",(0,i.jsxs)(n.li,{children:["Send action goal: ",(0,i.jsx)(n.code,{children:'ros2 action send_goal /fibonacci example_interfaces/action/Fibonacci "{order: 5}"'})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"In this lab, you learned how to create and use services and actions in ROS 2. Services are good for simple request/response interactions, while actions are better for long-running tasks that need feedback."})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,c){c.d(n,{R:()=>a,x:()=>t});var i=c(6540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);